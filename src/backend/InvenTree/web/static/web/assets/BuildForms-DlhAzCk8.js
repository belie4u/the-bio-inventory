import{r as d,i as a,j as e,bV as T,ej as y,bR as c,S as R,by as A,bQ as B,aC as D,ap as O,aG as V,aL as b,b4 as w,ah as Q,bx as P,G as U,I as G,B as $}from"./vendor-COjCG5sX.js";import{A as p,e as g,f as W,m as S}from"./index-ClP83spC.js";import{R as q}from"./RemoveRowButton-CcCl0sVr.js";import{b as j,E as L,w as N,S as k,F as z,h as X}from"./UseForm-DUtLE7-5.js";import{P as C}from"./index-dkDFLfDd.js";import{a as Y,u as E}from"./UseGenerator-CdxkBrcC.js";import{l as v}from"./ColumnRenderers-g3zQL0h_.js";function le({create:t,modalId:i}){const[r,s]=d.useState(null),[l,o]=d.useState(""),n=E({modalId:i,onGenerate:_=>{o(x=>x||_)}}),m=W();return d.useMemo(()=>{const _={reference:{},part:{disabled:!t,filters:{assembly:!0,virtual:!1,active:m.isSet("BUILDORDER_REQUIRE_ACTIVE_PART")?!0:void 0,locked:m.isSet("BUILDORDER_REQUIRE_LOCKED_PART")?!0:void 0},onValueChange(x,f){f&&s(f.default_location||f.category_default_location),n.update({part:x})}},title:{},quantity:{},project_code:{icon:e.jsx(P,{})},priority:{},parent:{icon:e.jsx(Q,{}),filters:{part_detail:!0}},sales_order:{icon:e.jsx(w,{})},batch:{placeholder:n.result&&`${a._({id:"iAY2dt"})}: ${n.result}`,value:l,onValueChange:x=>o(x)},start_date:{icon:e.jsx(b,{})},target_date:{icon:e.jsx(b,{})},take_from:{},destination:{filters:{structural:!1},value:r},link:{icon:e.jsx(V,{})},issued_by:{icon:e.jsx(O,{}),filters:{is_active:!0}},responsible:{icon:e.jsx(D,{}),filters:{is_active:!0}},external:{}};return m.isSet("PROJECT_CODES_ENABLED",!0)||delete _.project_code,m.isSet("BUILDORDER_EXTERNAL_BUILDS",!0)||delete _.external,_},[t,r,l,n.result,m])}function re({build:t,modalId:i}){var x,f;const r=d.useMemo(()=>{var u;return((u=t.part_detail)==null?void 0:u.trackable)??!1},[t.part_detail]),[s,l]=d.useState(null);d.useEffect(()=>{var u;l(t.location||((u=t.part_detail)==null?void 0:u.default_location)||null)},[t.location,t.part_detail]);const[o,n]=d.useState(0);d.useEffect(()=>{const u=t.quantity??0,h=t.completed??0;n(Math.max(0,u-h))},[t]);const m=Y({modalId:i,initialQuery:{part:t.part||((x=t.part_detail)==null?void 0:x.pk)}}),_=E({modalId:i,initialQuery:{part:t.part||((f=t.part_detail)==null?void 0:f.pk),quantity:t.quantity}});return d.useMemo(()=>({quantity:{value:o,onValueChange:u=>{n(u)}},serial_numbers:{hidden:!r,placeholder:m.result&&`${a._({id:"TVYdHj"})}: ${m.result}`},batch_code:{placeholder:_.result&&`${a._({id:"iAY2dt"})}: ${_.result}`},location:{value:s,onValueChange:u=>{n(u)}},auto_allocate:{hidden:!r}}),[o,_.result,m.result,r])}function F({props:t,record:i}){const r=d.useMemo(()=>i.serial?`# ${i.serial}`:`${a._({id:"VbWX2u"})}: ${i.quantity}`,[i]),s=d.useMemo(()=>{var l,o;return i.serial?"1":e.jsx(k,{fieldName:"quantity",fieldDefinition:{field_type:"number",required:!0,value:t.item.quantity,onValueChange:n=>{t.changeFn(t.idx,"quantity",n)}},error:(o=(l=t.rowErrors)==null?void 0:l.quantity)==null?void 0:o.message})},[t,i]);return e.jsx(e.Fragment,{children:e.jsxs(c.Tr,{children:[e.jsx(c.Td,{children:e.jsx(v,{part:i.part_detail})}),e.jsx(c.Td,{children:r}),e.jsx(c.Td,{children:e.jsx(z,{props:t,errorKey:"output",children:s})}),e.jsx(c.Td,{children:i.batch}),e.jsxs(c.Td,{children:[e.jsx(X,{status:i.status,type:S.stockitem})," "]}),e.jsx(c.Td,{style:{width:"1%",whiteSpace:"nowrap"},children:e.jsx(q,{onClick:()=>t.removeFn(t.idx)})})]})})}function oe({build:t,outputs:i,onFormSuccess:r}){const[s,l]=d.useState(null);d.useEffect(()=>{var n;s||l(t.destination||((n=t.part_detail)==null?void 0:n.default_location)||null)},[s,t.destination,t.part_detail]);const o=d.useMemo(()=>({outputs:{field_type:"table",value:i.map(n=>({output:n.pk,quantity:n.quantity})),modelRenderer:n=>{const m=i.find(_=>_.pk==n.item.output);return e.jsx(F,{props:n,record:m},m.pk)},headers:[{title:a._({id:"vgP+9p"})},{title:a._({id:"gILim+"})},{title:a._({id:"h9GdVS"}),style:{width:"200px"}},{title:a._({id:"rsx3xA"})},{title:a._({id:"uAQUqI"})},{title:"",style:{width:"50px"}}]},status_custom_key:{},location:{filters:{structural:!1},value:s,onValueChange:n=>{l(n)}},notes:{},accept_incomplete_allocation:{}}),[s,i]);return j({url:g(p.build_output_complete,t.pk),method:"POST",title:a._({id:"0iR9fu"}),fields:o,onFormSuccess:r,successMessage:a._({id:"N3avUJ"}),size:"80%"})}function de({build:t,outputs:i,onFormSuccess:r}){const[s,l]=d.useState(null);d.useEffect(()=>{var n;s||l(t.destination||((n=t.part_detail)==null?void 0:n.default_location)||null)},[s,t.destination,t.part_detail]);const o=d.useMemo(()=>({outputs:{field_type:"table",value:i.map(n=>({output:n.pk,quantity:n.quantity})),modelRenderer:n=>{const m=i.find(_=>_.pk==n.item.output);return e.jsx(F,{props:n,record:m},m.pk)},headers:[{title:a._({id:"vgP+9p"})},{title:a._({id:"gILim+"})},{title:a._({id:"1th0FY"}),style:{width:"200px"}},{title:a._({id:"rsx3xA"})},{title:a._({id:"uAQUqI"})},{title:"",style:{width:"50px"}}]},location:{value:s,onValueChange:n=>{l(n)}},notes:{},discard_allocations:{}}),[s,i]);return j({url:g(p.build_output_scrap,t.pk),method:"POST",title:a._({id:"69qbY/"}),preFormContent:e.jsx(T,{title:a._({id:"69qbY/"}),color:"yellow",children:e.jsxs(y,{children:[e.jsx(y.Item,{children:a._({id:"zHVfrv"})}),e.jsx(y.Item,{children:a._({id:"SUX6xX"})})]})}),fields:o,onFormSuccess:r,successMessage:a._({id:"C+tSd4"}),size:"80%"})}function ue({build:t,outputs:i,onFormSuccess:r}){const s=d.useMemo(()=>({outputs:{field_type:"table",value:i.map(l=>({output:l.pk})),modelRenderer:l=>{const o=i.find(n=>n.pk==l.item.output);return e.jsx(F,{props:l,record:o},o.pk)},headers:[{title:a._({id:"vgP+9p"})},{title:a._({id:"igx8Og"})},{title:a._({id:"rsx3xA"})},{title:a._({id:"uAQUqI"})},{title:"",style:{width:"50px"}}]}}),[i]);return j({url:g(p.build_output_delete,t.pk),method:"POST",title:a._({id:"xS5DxW"}),preFormContent:e.jsx(T,{title:a._({id:"xS5DxW"}),color:"yellow",children:e.jsxs(y,{children:[e.jsx(y.Item,{children:a._({id:"yFxIv1"})}),e.jsx(y.Item,{children:a._({id:"SSAZQG"})})]})}),fields:s,onFormSuccess:r,successMessage:a._({id:"cdFWk4"}),size:"80%"})}function H({props:t,output:i,record:r,sourceLocation:s}){var n,m,_,x;const l=d.useMemo(()=>({field_type:"related field",api_url:g(p.stock_item_list),model:S.stockitem,autoFill:!!(i!=null&&i.serial),autoFillFilters:{serial:i==null?void 0:i.serial},filters:{available:!0,part_detail:!0,location_detail:!0,bom_item:r.bom_item,location:s,cascade:s?!0:void 0},value:t.item.stock_item,name:"stock_item",onValueChange:(f,u)=>{if(t.changeFn(t.idx,"stock_item",f),u){const h=u.quantity-u.allocated;h<t.item.quantity&&t.changeFn(t.idx,"quantity",Math.min(t.item.quantity,h))}}}),[r,t]),o=d.useMemo(()=>({field_type:"number",name:"quantity",required:!0,value:t.item.quantity,onValueChange:f=>{t.changeFn(t.idx,"quantity",f)}}),[t]);return e.jsxs(c.Tr,{children:[e.jsx(c.Td,{children:e.jsx(v,{part:r.part_detail})}),e.jsx(c.Td,{children:e.jsx(C,{value:r.allocatedQuantity,maximum:r.requiredQuantity-r.consumed,progressLabel:!0})}),e.jsx(c.Td,{children:e.jsx(k,{fieldName:"stock_item",fieldDefinition:l,error:(m=(n=t.rowErrors)==null?void 0:n.stock_item)==null?void 0:m.message})}),e.jsx(c.Td,{children:e.jsx(k,{fieldName:"quantity",fieldDefinition:o,error:(x=(_=t.rowErrors)==null?void 0:_.quantity)==null?void 0:x.message})}),e.jsx(c.Td,{children:e.jsx(q,{onClick:()=>t.removeFn(t.idx)})})]},`table-row-${r.pk}`)}function ce({buildId:t,output:i,outputId:r,build:s,lineItems:l,onFormSuccess:o}){const[n,m]=d.useState(void 0),_=d.useMemo(()=>({items:{field_type:"table",value:[],headers:[{title:a._({id:"vgP+9p"}),style:{minWidth:"175px"}},{title:a._({id:"A/ybx7"}),style:{minWidth:"175px"}},{title:a._({id:"igx8Og"}),style:{width:"100%"}},{title:a._({id:"VbWX2u"}),style:{minWidth:"175px"}},{title:"",style:{width:"50px"}}],modelRenderer:h=>{const I=l.find(M=>M.pk==h.item.build_line)??{};return e.jsx(H,{output:i,props:h,record:I,sourceLocation:n},h.idx)}}}),[i,l,n]);d.useEffect(()=>{m(s==null?void 0:s.take_from)},[s==null?void 0:s.take_from]);const x=d.useMemo(()=>({field_type:"related field",api_url:g(p.stock_location_list),model:S.stocklocation,required:!1,label:a._({id:"/00Ond"}),description:a._({id:"IArqwk"}),name:"source_location",value:s==null?void 0:s.take_from,onValueChange:u=>{m(u)}}),[s==null?void 0:s.take_from]),f=d.useMemo(()=>e.jsxs(R,{gap:"xs",children:[(i==null?void 0:i.pk)&&e.jsxs(R,{gap:"xs",children:[e.jsx(T,{color:"blue",icon:e.jsx(A,{}),title:a._({id:"gILim+"}),children:e.jsx(L,{instance:i})}),e.jsx(B,{})]}),e.jsx(k,{fieldDefinition:x})]}),[i,x]);return j({url:p.build_order_allocate,pk:t,title:a._({id:"L1LMmH"}),fields:_,preFormContent:f,successMessage:a._({id:"23SrHL"}),onFormSuccess:o,initialData:{items:l.filter(u=>r?!0:u.requiredQuantity>u.allocatedQuantity+u.consumed).map(u=>({build_line:u.pk,stock_item:void 0,quantity:Math.max(0,u.requiredQuantity-u.allocatedQuantity-u.consumed),output:r}))},size:"80%"})}function K({props:t,record:i}){var r,s;return e.jsxs(c.Tr,{children:[e.jsx(c.Td,{children:e.jsx(v,{part:i.part_detail})}),e.jsx(c.Td,{children:e.jsx(L,{instance:i.stock_item_detail})}),e.jsx(c.Td,{children:i.location_detail&&e.jsx(N,{instance:i.location_detail})}),e.jsx(c.Td,{children:i.quantity}),e.jsx(c.Td,{children:e.jsx(k,{fieldName:"quantity",fieldDefinition:{field_type:"number",required:!0,value:t.item.quantity,onValueChange:l=>{t.changeFn(t.idx,"quantity",l)}},error:(s=(r=t.rowErrors)==null?void 0:r.quantity)==null?void 0:s.message})}),e.jsx(c.Td,{children:e.jsx(q,{onClick:()=>t.removeFn(t.idx)})})]},`table-row-${i.pk}`)}function me({buildId:t,allocatedItems:i,onFormSuccess:r}){const s=d.useMemo(()=>({items:{field_type:"table",value:[],headers:[{title:a._({id:"vgP+9p"})},{title:a._({id:"igx8Og"})},{title:a._({id:"wJijgU"})},{title:a._({id:"A/ybx7"})},{title:a._({id:"VbWX2u"})}],modelRenderer:l=>{const o=i.find(n=>n.pk==l.item.build_item);return e.jsx(K,{props:l,record:o},l.idx)}},notes:{}}),[i]);return j({url:p.build_order_consume,pk:t,title:a._({id:"8nBqTf"}),successMessage:a._({id:"lxxoKL"}),onFormSuccess:r,size:"80%",fields:s,initialData:{items:i.map(l=>({build_item:l.pk,quantity:l.quantity}))}})}function J({props:t,record:i}){const r=i.allocatedQuantity??i.allocated,s=i.requiredQuantity??i.required,l=Math.max(0,s-i.consumed);return e.jsxs(c.Tr,{children:[e.jsx(c.Td,{children:e.jsx(v,{part:i.part_detail})}),e.jsx(c.Td,{children:l<=0?e.jsxs(U,{gap:"xs",children:[e.jsx(G,{size:16,color:"green"}),e.jsx($,{size:"sm",style:{fontStyle:"italic"},children:a._({id:"e02p4q"})})]}):e.jsx(C,{value:r,maximum:l,progressLabel:!0})}),e.jsx(c.Td,{children:e.jsx(C,{value:i.consumed,maximum:i.quantity,progressLabel:!0})}),e.jsx(c.Td,{children:e.jsx(q,{onClick:()=>t.removeFn(t.idx)})})]},`table-row-${i.pk}`)}function _e({buildId:t,buildLines:i,onFormSuccess:r}){const s=d.useMemo(()=>i.filter(o=>{var n;return!((n=o.part_detail)!=null&&n.trackable)}),[i]),l=d.useMemo(()=>({lines:{field_type:"table",value:[],headers:[{title:a._({id:"vgP+9p"})},{title:a._({id:"A/ybx7"})},{title:a._({id:"XNITBt"})}],modelRenderer:o=>{const n=s.find(m=>m.pk==o.item.build_line);return e.jsx(J,{props:o,record:n},o.idx)}},notes:{}}),[s]);return j({url:p.build_order_consume,pk:t,title:a._({id:"8nBqTf"}),successMessage:a._({id:"lxxoKL"}),onFormSuccess:r,fields:l,initialData:{lines:s.map(o=>({build_line:o.pk}))}})}export{ce as a,_e as b,me as c,re as d,oe as e,de as f,ue as g,le as u};
//# sourceMappingURL=BuildForms-DlhAzCk8.js.map
