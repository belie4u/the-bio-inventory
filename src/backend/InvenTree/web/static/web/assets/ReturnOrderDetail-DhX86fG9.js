import{r as i,i as t,j as r,eN as G,cy as J,dA as W,by as ee,bX as y,bx as te,S as re}from"./vendor-COjCG5sX.js";import{b as z,m as o,A as a,U as d,e as S,f as se}from"./index-ClP83spC.js";import{A as oe}from"./AdminButton-DmZZOxW8.js";import{P as V}from"./PrimaryActionButton-SR4hKiWf.js";import{u as ne,o as ie,R as ae,a as le,I as de,z as ce,P as ue,O as me,E as pe,F as _e,Z as he,_ as ye}from"./InvenTreeTable-BLgfUICM.js";import{I as be,D as M,a as xe}from"./InstanceDetail-D0JUiPv3.js";import{D as fe,N as ge}from"./NotesPanel-2dK9X1T7.js";import{q as ke,S as B}from"./ThemeContext-B85sS1BU.js";import{P as Ce}from"./PageDetail-p6Y4q-h-.js";import{A as Re}from"./AttachmentPanel-Be6kmD3E.js";import{P as Se}from"./PanelGroup-CYF3auDg.js";import{b as x,u as X,a as je,A as Ie,h as Ae}from"./UseForm-DUtLE7-5.js";import{a as Y}from"./formatters-BZ5YEOyk.js";import{a as Z,b as Fe,u as H}from"./ReturnOrderForms-C-j_t4gS.js";import{u as De}from"./UseInstance-CwLXxgXl.js";import{u as $}from"./UseStatusCodes-ChLgWVsN.js";import{E as Pe}from"./ExtraLineItemTable-CuGET5Ep.js";import{A as Ne}from"./ActionButton-DLsRvAT1.js";import{P as Oe,D as Ee,S as K,R as Le,k as Q,N as Me,L as ve}from"./ColumnRenderers-g3zQL0h_.js";import"./DesktopAppView-DxQJo3T-.js";import"./index-dkDFLfDd.js";import"./QRCode-tr3h0Ayp.js";import"./browser-BL541dLs.js";import"./YesNoButton-DD4RFE30.js";import"./ModelType-CaQkIuKb.js";import"./GenericErrorPage-DS07aljU.js";import"./NotFound-LPA9XMjd.js";import"./PermissionDenied-DglG0Y8V.js";import"./PageTitle-Cvnbh7U4.js";import"./AttachmentLink-Bdm2Ykvd.js";import"./PluginSource-CHMSfDB-.js";import"./RemoteComponent-C77F08TN.js";import"./RemoveRowButton-CcCl0sVr.js";import"./CommonForms-CICCJ9xM.js";function Te({orderId:u,order:m,orderDetailRefresh:b,customerId:e,currency:p}){const n=ne("return-order-line-item"),c=z(),j=$({modelType:o.returnorder}),[I,A]=i.useState(0),_=i.useMemo(()=>m.status==j.IN_PROGRESS,[m,j]),v=Z({orderId:u,customerId:e,create:!0}),f=Z({orderId:u,customerId:e}),F=x({url:a.return_order_line_list,title:t._({id:"pwb7Yo"}),fields:v,initialData:{order:u,price_currency:p},onFormSuccess:b,table:n}),g=X({url:a.return_order_line_list,pk:I,title:t._({id:"vgosWS"}),fields:f,onFormSuccess:b,table:n}),k=je({url:a.return_order_line_list,pk:I,title:t._({id:"tpKh8C"}),onFormSuccess:b,table:n}),D=i.useMemo(()=>[Oe({part:"part_detail"}),{accessor:"part_detail.IPN",sortable:!1},Ee({accessor:"part_detail.description"}),{accessor:"item_detail.serial",title:t._({id:"VbWX2u"}),switchable:!1,render:s=>s.item_detail.serial&&s.quantity==1?`# ${s.item_detail.serial}`:s.quantity},K({model:o.stockitem,sortable:!1,accessor:"item_detail.status",title:t._({id:"uAQUqI"})}),Le({}),K({model:o.returnorderlineitem,sortable:!0,accessor:"outcome"}),{accessor:"price",render:s=>Y(s.price,{currency:s.price_currency})},Q({accessor:"target_date",title:t._({id:"ZmykKo"})}),Q({accessor:"received_date",title:t._({id:"J18WDZ"})}),Me({accessor:"notes"}),ve({})],[]),P=i.useMemo(()=>[{name:"received",label:t._({id:"fZ5Vnu"}),description:t._({id:"qVsPia"})},{name:"status",label:t._({id:"uAQUqI"}),description:t._({id:"vQY+8t"}),choiceFunction:ie(o.returnorderlineitem)}],[]),N=i.useMemo(()=>[r.jsx(Ie,{tooltip:t._({id:"pwb7Yo"}),hidden:!c.hasAddRole(d.return_order),onClick:()=>{F.open()}},"add-line-item"),r.jsx(Ne,{tooltip:t._({id:"ORa4sV"}),icon:r.jsx(G,{}),hidden:!_||!c.hasChangeRole(d.return_order),onClick:()=>{O(n.selectedRecords.filter(s=>!s.received_date)),C.open()},disabled:n.selectedRecords.length==0},"receive-items")],[c,_,u,n.selectedRecords]),[l,O]=i.useState([]),C=Fe({orderId:u,items:l,onFormSuccess:s=>n.refreshTable()}),E=i.useCallback(s=>[{hidden:!!(s!=null&&s.received_date)||!_||!c.hasChangeRole(d.return_order),title:t._({id:"7cTlo3"}),icon:r.jsx(G,{}),onClick:()=>{O([s]),C.open()}},ae({hidden:!c.hasChangeRole(d.return_order),onClick:()=>{A(s.pk),g.open()}}),le({hidden:!c.hasDeleteRole(d.return_order),onClick:()=>{A(s.pk),k.open()}})],[c,_]);return r.jsxs(r.Fragment,{children:[F.modal,g.modal,k.modal,C.modal,r.jsx(de,{url:S(a.return_order_line_list),tableState:n,columns:D,props:{params:{order:u,part_detail:!0,item_detail:!0,order_detail:!0},enableSelection:_&&c.hasChangeRole(d.return_order),tableActions:N,tableFilters:P,rowActions:E,modelField:"item",modelType:o.stockitem}})]})}function xt(){var E;const{id:u}=ke(),m=z(),b=se(),{instance:e,instanceQuery:p,refreshInstance:n}=De({endpoint:a.return_order_list,pk:u,params:{customer_detail:!0}}),c=i.useMemo(()=>{var s;return e.order_currency||((s=e.customer_detail)==null?void 0:s.currency)||b.getSetting("INVENTREE_DEFAULT_CURRENCY")},[e,b]),j=i.useMemo(()=>{var L,U,w;if(p.isFetching)return r.jsx(J,{});const s=[{type:"text",name:"reference",label:t._({id:"N2C89m"}),copy:!0},{type:"text",name:"customer_reference",label:t._({id:"ZVUe1A"}),icon:"customer",copy:!0,hidden:!e.customer_reference},{type:"link",name:"customer",icon:"customers",label:t._({id:"876pfE"}),model:o.company},{type:"text",name:"description",label:t._({id:"Nu4oKW"}),copy:!0},{type:"status",name:"status",label:t._({id:"uAQUqI"}),model:o.returnorder},{type:"status",name:"status_custom_key",label:t._({id:"4DvUAJ"}),model:o.returnorder,icon:"status",hidden:!e.status_custom_key||e.status_custom_key==e.status}],h=[{type:"text",name:"line_items",label:t._({id:"SgduFH"}),icon:"list"},{type:"progressbar",name:"completed",icon:"progress",label:t._({id:"qgs95u"}),total:e.line_items,progress:e.completed_lines},{type:"text",name:"currency",label:t._({id:"0UZTSq"}),value_formatter:()=>{var R;return(e==null?void 0:e.order_currency)??((R=e==null?void 0:e.customer_detail)==null?void 0:R.currency)}},{type:"text",name:"total_price",label:t._({id:"A6C0pv"}),value_formatter:()=>{var R;return Y(e==null?void 0:e.total_price,{currency:(e==null?void 0:e.order_currency)||((R=e==null?void 0:e.customer_detail)==null?void 0:R.currency)})}}],T=[{type:"link",external:!0,name:"link",label:t._({id:"yzF66j"}),copy:!0,hidden:!e.link},{type:"text",name:"contact_detail.name",label:t._({id:"jfC/xh"}),icon:"user",copy:!0,hidden:!e.contact},{type:"text",name:"contact_detail.email",label:t._({id:"41BQ3k"}),icon:"email",copy:!0,hidden:!((L=e.contact_detail)!=null&&L.email)},{type:"text",name:"contact_detail.phone",label:t._({id:"P1x5uo"}),icon:"phone",copy:!0,hidden:!((U=e.contact_detail)!=null&&U.phone)},{type:"text",name:"project_code_label",label:t._({id:"Sdfr6G"}),icon:"reference",copy:!0,hidden:!e.project_code},{type:"text",name:"responsible",label:t._({id:"XQACoK"}),badge:"owner",hidden:!e.responsible}],q=[{type:"date",name:"creation_date",label:t._({id:"FNcMGM"}),icon:"calendar",copy:!0,hidden:!e.creation_date},{type:"date",name:"issue_date",label:t._({id:"M1cChr"}),icon:"calendar",copy:!0,hidden:!e.issue_date},{type:"date",name:"start_date",label:t._({id:"D3iCkb"}),icon:"calendar",copy:!0,hidden:!e.start_date},{type:"date",name:"target_date",label:t._({id:"ZmykKo"}),copy:!0,hidden:!e.target_date},{type:"date",name:"complete_date",icon:"calendar_check",label:t._({id:"41ha49"}),copy:!0,hidden:!e.complete_date}];return r.jsxs(be,{children:[r.jsxs(W,{grow:!0,children:[r.jsx(fe,{appRole:d.purchase_order,apiPath:a.company_list,src:(w=e.customer_detail)==null?void 0:w.image,pk:e.customer}),r.jsx(W.Col,{span:{base:12,sm:8},children:r.jsx(M,{fields:s,item:e})})]}),r.jsx(M,{fields:h,item:e}),r.jsx(M,{fields:T,item:e}),r.jsx(M,{fields:q,item:e})]})},[e,p]),I=i.useMemo(()=>[{name:"detail",label:t._({id:"Tol4BF"}),icon:r.jsx(ee,{}),content:j},{name:"line-items",label:t._({id:"SgduFH"}),icon:r.jsx(te,{}),content:r.jsxs(y,{multiple:!0,defaultValue:["line-items","extra-items"],children:[r.jsxs(y.Item,{value:"line-items",children:[r.jsx(y.Control,{children:r.jsx(B,{size:"lg",children:t._({id:"SgduFH"})})}),r.jsx(y.Panel,{children:r.jsx(Te,{orderId:e.pk,order:e,orderDetailRefresh:n,customerId:e.customer,currency:c})})]},"lineitems"),r.jsxs(y.Item,{value:"extra-items",children:[r.jsx(y.Control,{children:r.jsx(B,{size:"lg",children:t._({id:"l11DG/"})})}),r.jsx(y.Panel,{children:r.jsx(Pe,{endpoint:a.return_order_extra_line_list,orderId:e.pk,orderDetailRefresh:n,currency:c,role:d.return_order})})]},"extraitems")]})},Re({model_type:o.returnorder,model_id:e.pk}),ge({model_type:o.returnorder,model_id:e.pk})],[e,u,m]),A=i.useMemo(()=>p.isLoading?[]:[r.jsx(Ae,{status:e.status_custom_key,type:o.returnorder,options:{size:"lg"}})],[e,p]),_=H({}),v=H({duplicateOrderId:e.pk}),f=X({url:a.return_order_list,pk:e.pk,title:t._({id:"RDcVR0"}),fields:_,onFormSuccess:()=>{n()}}),F=i.useMemo(()=>{const s={...e};return delete s.reference,s},[e]),g=x({url:a.return_order_list,title:t._({id:"mpNlR/"}),fields:v,initialData:F,modelType:o.returnorder,follow:!0}),k=x({url:S(a.return_order_issue,e.pk),title:t._({id:"LUGEsQ"}),onFormSuccess:n,preFormWarning:t._({id:"lLiNZC"}),successMessage:t._({id:"R/WvFK"})}),D=x({url:S(a.return_order_cancel,e.pk),title:t._({id:"qOAlIV"}),onFormSuccess:n,preFormWarning:t._({id:"MPFqR0"}),successMessage:t._({id:"H5qWhm"})}),P=x({url:S(a.return_order_hold,e.pk),title:t._({id:"Sd+hNf"}),onFormSuccess:n,preFormWarning:t._({id:"3Wfk51"}),successMessage:t._({id:"0NH/ob"})}),N=x({url:S(a.return_order_complete,e.pk),title:t._({id:"yDIX54"}),onFormSuccess:n,preFormWarning:t._({id:"DYITap"}),successMessage:t._({id:"W7TghJ"})}),l=$({modelType:o.returnorder}),O=i.useMemo(()=>{const s=m.hasChangeRole(d.return_order),h=s&&(e.status==l.PENDING||e.status==l.ON_HOLD),T=s&&(e.status==l.PENDING||e.status==l.PLACED||e.status==l.IN_PROGRESS),q=s&&(e.status==l.PENDING||e.status==l.IN_PROGRESS||e.status==l.ON_HOLD),L=s&&e.status==l.IN_PROGRESS;return[r.jsx(V,{title:t._({id:"WajCDs"}),icon:"issue",hidden:!h,color:"blue",onClick:()=>k.open()}),r.jsx(V,{title:t._({id:"NPZqBL"}),icon:"complete",hidden:!L,color:"green",onClick:()=>N.open()}),r.jsx(oe,{model:o.returnorder,id:e.pk}),r.jsx(ce,{model:o.returnorder,pk:e.pk,hash:e==null?void 0:e.barcode_hash}),r.jsx(ue,{modelType:o.returnorder,items:[e.pk],enableReports:!0}),r.jsx(me,{tooltip:t._({id:"/IKytX"}),actions:[pe({hidden:!m.hasChangeRole(d.return_order),tooltip:t._({id:"mVeaUg"}),onClick:()=>{f.open()}}),_e({tooltip:t._({id:"oi/3Pq"}),hidden:!m.hasChangeRole(d.return_order),onClick:()=>g.open()}),he({tooltip:t._({id:"20mLBC"}),hidden:!T,onClick:()=>P.open()}),ye({tooltip:t._({id:"tVJk4q"}),hidden:!q,onClick:()=>D.open()})]})]},[m,e,l]),C=i.useMemo(()=>{var h;let s=((h=e.customer_detail)==null?void 0:h.name)||"";return e.customer_reference&&(s+=` (${e.customer_reference})`),s},[e]);return r.jsxs(r.Fragment,{children:[f.modal,k.modal,D.modal,P.modal,N.modal,g.modal,r.jsx(xe,{query:p,requiredRole:d.return_order,children:r.jsxs(re,{gap:"xs",children:[r.jsx(Ce,{title:`${t._({id:"Z6ve1w"})}: ${e.reference}`,subtitle:C,imageUrl:(E=e.customer_detail)==null?void 0:E.image,badges:A,actions:O,breadcrumbs:[{name:t._({id:"mUv9U4"}),url:"/sales/"}],lastCrumb:[{name:e.reference,url:`/sales/return-order/${e.pk}`}],editAction:f.open,editEnabled:m.hasChangePermission(o.returnorder)}),r.jsx(Se,{pageKey:"returnorder",panels:I,model:o.returnorder,reloadInstance:p.refetch,instance:e,id:e.pk})]})})]})}export{xt as default};
//# sourceMappingURL=ReturnOrderDetail-DhX86fG9.js.map
