import{r as d,i as e,j as l,b9 as V,aV as L,B as p,G as O}from"./vendor-COjCG5sX.js";import{b as A,u as N,c as q,A as B,g as _,n as D}from"./UseForm-DUtLE7-5.js";import{u as G,R as Y,G as z,y as W,I as $}from"./InvenTreeTable-BLgfUICM.js";import{e as j,A as b,f as R,b as K,m as f,U as g}from"./index-ClP83spC.js";import{O as U}from"./OrderPartsWizard-CHxSYjNR.js";import{b as J}from"./formatters-BZ5YEOyk.js";import{u as Q}from"./DesktopAppView-DxQJo3T-.js";import{I as T}from"./ThemeContext-B85sS1BU.js";import{P as X,D as H,m as Z,n as ee,L as te}from"./ColumnRenderers-g3zQL0h_.js";function v({create:t=!1}){const o=R();return d.useMemo(()=>{const i={category:{filters:{structural:!1}},name:{},IPN:{},description:{},revision:{},revision_of:{filters:{is_revision:!1,is_template:!1}},variant_of:{filters:{is_template:!0}},keywords:{},units:{},link:{},default_location:{filters:{structural:!1}},default_expiry:{},minimum_stock:{},responsible:{filters:{is_active:!0}},component:{},assembly:{},is_template:{},testable:{},trackable:{},purchaseable:{},salable:{},virtual:{},locked:{},active:{},starred:{field_type:"boolean",label:e._({id:"7VIaU3"}),description:e._({id:"wyHaGh"}),disabled:!1,required:!1}};return t&&(i.copy_category_parameters={},i.initial_stock={icon:l.jsx(V,{}),children:{quantity:{value:0},location:{}}},i.initial_supplier={children:{supplier:{filters:{is_supplier:!0}},sku:{},manufacturer:{filters:{is_manufacturer:!0}},mpn:{}}}),o.isSet("PART_REVISION_ASSEMBLY_ONLY")&&(i.revision_of.filters.assembly=!0),o.isSet("PART_ENABLE_REVISION")||(delete i.revision,delete i.revision_of),o.isSet("STOCK_ENABLE_EXPIRY")||delete i.default_expiry,t&&delete i.starred,i},[t,o])}function _e({create:t}){return d.useMemo(()=>{const i={parent:{description:e._({id:"oATGL2"}),required:!1},name:{},description:{},default_location:{filters:{structural:!1}},default_keywords:{},structural:{},starred:{field_type:"boolean",label:e._({id:"7VIaU3"}),description:e._({id:"8Qu8gC"}),disabled:!1,required:!1},icon:{field_type:"icon"}};return t&&delete i.starred,i},[t])}function me({editTemplate:t}){const o=Q(),[i,c]=d.useState([]),[s,n]=d.useState("string");return d.useMemo(()=>({part:{disabled:!0},template:{disabled:t==!1,onValueChange:(u,a)=>{if(a!=null&&a.checkbox)c([]),n("boolean");else if(a!=null&&a.choices){const m=a.choices.split(",");m.length>0?(c(m.map(r=>({display_name:r.trim(),value:r.trim()}))),n("choice")):(c([]),n("string"))}else a!=null&&a.selectionlist?o.get(j(b.selectionlist_detail,a.selectionlist)).then(m=>{c(m.data.choices.map(r=>({value:r.value,display_name:r.label}))),n("choice")}):(c([]),n("string"))}},data:{type:s,field_type:s,choices:s==="choice"?i:void 0,default:s==="boolean"?!1:void 0,adjustValue:u=>{let a=u.toString().trim();return s==="boolean"&&a.toLowerCase()!=="true"&&(a="false"),a}},note:{}}),[t,s,i])}function be(){return{part:{hidden:!0},quantity:{},item_count:{},cost_min:{},cost_min_currency:{},cost_max:{},cost_max_currency:{},note:{}}}function ae(){return[X({part:"",accessor:"name"}),{accessor:"IPN",sortable:!0},{accessor:"revision",sortable:!0},{accessor:"units",sortable:!0},H({}),Z({accessor:"category_detail"}),ee({accessor:"default_location_detail"}),{accessor:"total_in_stock",sortable:!0,render:t=>{const o=[],i=(t==null?void 0:t.total_in_stock)??0,c=((t==null?void 0:t.allocated_to_build_orders)??0)+((t==null?void 0:t.allocated_to_sales_orders)??0),s=Math.max(0,i-c),n=(t==null?void 0:t.minimum_stock)??0;let u=String(_(i)),a;return n>i&&(o.push(l.jsx(p,{c:"orange",children:`${e._({id:"Lgnuy/"})}: ${_(n)}`},"min-stock")),a="orange"),t.ordering>0&&o.push(l.jsx(p,{children:`${e._({id:"0lg3zX"})}: ${_(t.ordering)}`},"on-order")),t.building&&o.push(l.jsx(p,{children:`${e._({id:"oZd08v"})}: ${_(t.building)}`},"building")),t.allocated_to_build_orders>0&&o.push(l.jsx(p,{children:`${e._({id:"KCpl4N"})}: ${_(t.allocated_to_build_orders)}`},"bo-allocations")),t.allocated_to_sales_orders>0&&o.push(l.jsx(p,{children:`${e._({id:"DaWMWw"})}: ${_(t.allocated_to_sales_orders)}`},"so-allocations")),s!=i&&o.push(l.jsxs(p,{children:[e._({id:"csDS2L"}),": ",_(s)]},"available")),t.external_stock>0&&o.push(l.jsxs(p,{children:[e._({id:"e8fwfT"}),": ",_(t.external_stock)]},"external")),i<=0?(a="red",u=e._({id:"AbC1Px"})):s<=0?a="orange":s<n&&(a="yellow"),l.jsx(D,{value:l.jsxs(O,{gap:"xs",justify:"left",wrap:"nowrap",children:[l.jsx(p,{c:a,children:u}),t.units&&l.jsxs(p,{size:"xs",c:a,children:["[",t.units,"]"]})]}),title:e._({id:"odasNw"}),extra:o})}},{accessor:"price_range",title:e._({id:"YA4hwj"}),sortable:!0,ordering:"pricing_max",defaultVisible:!1,render:t=>J(t.pricing_min,t.pricing_max)},te({})]}function ie(){return[{name:"active",label:e._({id:"F6pfE9"}),description:e._({id:"PHri/6"}),type:"boolean"},{name:"locked",label:e._({id:"G2fuEb"}),description:e._({id:"j5DYyt"}),type:"boolean"},{name:"assembly",label:e._({id:"WL36Yh"}),description:e._({id:"oQzKsK"}),type:"boolean"},{name:"bom_valid",label:e._({id:"RqzqYw"}),description:e._({id:"weW3ee"}),type:"boolean"},{name:"cascade",label:e._({id:"NgZniC"}),description:e._({id:"5JhtGd"}),type:"boolean"},{name:"component",label:e._({id:"dK3Z9j"}),description:e._({id:"oO7QIX"}),type:"boolean"},{name:"testable",label:e._({id:"bJsTOf"}),description:e._({id:"n8MVvQ"}),type:"boolean"},{name:"trackable",label:e._({id:"y6MnU0"}),description:e._({id:"MbixSq"}),type:"boolean"},{name:"has_units",label:e._({id:"YyRdJQ"}),description:e._({id:"WyFVby"}),type:"boolean"},{name:"has_ipn",label:e._({id:"c9/Fqb"}),description:e._({id:"jh/Aa+"}),type:"boolean"},{name:"has_stock",label:e._({id:"JqmfuT"}),description:e._({id:"6Kd+HK"}),type:"boolean"},{name:"low_stock",label:e._({id:"UgdO7s"}),description:e._({id:"GDYPCw"}),type:"boolean"},{name:"purchaseable",label:e._({id:"TW9g28"}),description:e._({id:"KMdl2R"}),type:"boolean"},{name:"salable",label:e._({id:"/3xNJ4"}),description:e._({id:"V5i7hf"}),type:"boolean"},{name:"virtual",label:e._({id:"ksX7Wx"}),description:e._({id:"QDTpY6"}),type:"choice",choices:[{value:"true",label:e._({id:"ksX7Wx"})},{value:"false",label:e._({id:"+SkaI8"})}]},{name:"is_template",label:e._({id:"62zyX+"}),description:e._({id:"utmCBg"}),type:"boolean"},{name:"is_variant",label:e._({id:"t/zat7"}),description:e._({id:"7xsBld"}),type:"boolean"},{name:"is_revision",label:e._({id:"wV5kLq"}),description:e._({id:"bvyXYp"})},{name:"has_revisions",label:e._({id:"uN6v7B"}),description:e._({id:"mWe3zs"})},{name:"has_pricing",label:e._({id:"T43R5B"}),description:e._({id:"/t4j0O"}),type:"boolean"},{name:"unallocated_stock",label:e._({id:"oGd3rK"}),description:e._({id:"NINff3"}),type:"boolean"},{name:"starred",label:e._({id:"7VIaU3"}),description:e._({id:"PNFIYy"}),type:"boolean"}]}function fe({props:t,defaultPartData:o}){const i=d.useMemo(()=>ae(),[]),c=d.useMemo(()=>ie(),[]),s=G("part-list"),n=K(),u=R(),a=d.useMemo(()=>o??t.params??{},[o,t.params]),m=A({url:b.part_list,title:e._({id:"rGfVOS"}),fields:v({create:!0}),initialData:a,follow:!0,modelType:f.part}),[r,x]=d.useState({}),h=N({url:b.part_list,pk:r.pk,title:e._({id:"enG3o5"}),fields:v({create:!1}),onFormSuccess:s.refreshTable}),k=v({create:!0}),w=d.useMemo(()=>({...k,duplicate:{children:{part:{value:r.pk,hidden:!0},copy_image:{value:!0},copy_bom:{value:r.assembly&&u.isSet("PART_COPY_BOM"),hidden:!r.assembly},copy_notes:{value:!0},copy_parameters:{value:u.isSet("PART_COPY_PARAMETERS")},copy_tests:{value:r.testable,hidden:!r.testable}}}}),[k,u,r]),y=A({url:b.part_list,title:e._({id:"rGfVOS"}),fields:w,initialData:{...r,active:!0,locked:!1},follow:!1,modelType:f.part,onFormSuccess:s.refreshTable}),S=q({url:b.part_list,items:s.selectedIds,title:e._({id:"JSqPHE"}),fields:{category:{}},onFormSuccess:s.refreshTable}),P=U({parts:s.selectedRecords}),I=d.useCallback(C=>{const E=n.hasChangePermission(f.part),F=n.hasAddPermission(f.part);return[Y({hidden:!E,onClick:()=>{x(C),h.open()}}),z({hidden:!F,onClick:()=>{x(C),y.open()}})]},[n,h,y]),M=d.useMemo(()=>[l.jsx(W,{tooltip:e._({id:"loB51L"}),icon:l.jsx(T,{icon:"part"}),disabled:!s.hasSelectedRecords,actions:[{name:e._({id:"JSqPHE"}),icon:l.jsx(T,{icon:"category"}),tooltip:e._({id:"AVPs2p"}),hidden:!n.hasChangeRole(g.part),disabled:!s.hasSelectedRecords,onClick:()=>{S.open()}},{name:e._({id:"3u5ICq"}),icon:l.jsx(L,{color:"blue"}),tooltip:e._({id:"RBzQBd"}),hidden:!n.hasAddRole(g.purchase_order),onClick:()=>{P.openWizard()}}]}),l.jsx(B,{hidden:!n.hasAddRole(g.part),tooltip:e._({id:"rGfVOS"}),onClick:()=>m.open()},"add-part")],[n,s.hasSelectedRecords]);return l.jsxs(l.Fragment,{children:[m.modal,y.modal,h.modal,S.modal,P.wizard,l.jsx($,{url:j(b.part_list),tableState:s,columns:i,props:{...t,enableDownload:!0,modelType:f.part,tableFilters:c,tableActions:M,rowActions:I,enableSelection:!0,enableReports:!0,enableLabels:!0,params:{...t.params,category_detail:!0,location_detail:!0}}})]})}export{fe as P,be as a,v as b,_e as p,me as u};
//# sourceMappingURL=PartTable-BNu26guL.js.map
