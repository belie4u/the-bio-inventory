import{r as n,i as t,j as o,G as B,cy as U,B as W,by as q,ah as G,b9 as L,S as J}from"./vendor-COjCG5sX.js";import{b as N,m as i,e as g,A as c,U as u,h as M,a as v}from"./index-ClP83spC.js";import{I as A,q as K,a as X,x as E}from"./ThemeContext-B85sS1BU.js";import{A as Y}from"./AdminButton-DmZZOxW8.js";import{u as Z,y as H,R as $,I as ee,z as te,P as oe,O as se,E as ae,D as ie}from"./InvenTreeTable-BLgfUICM.js";import{I as ne,D as F,a as ce}from"./InstanceDetail-D0JUiPv3.js";import{k as y,b as le,u as O,c as re,A as de,a as pe}from"./UseForm-DUtLE7-5.js";import{N as me}from"./NavigationTree-C5wV9DDo.js";import{P as ue}from"./PageDetail-p6Y4q-h-.js";import{P as _e}from"./PanelGroup-CYF3auDg.js";import{L as ke}from"./LocateItemButton-BZ31dqfp.js";import{s as P,a as be}from"./UseStockAdjustActions-DrD9IiH8.js";import{u as he}from"./UseInstance-CwLXxgXl.js";import{P as xe}from"./PartTable-BNu26guL.js";import{S as fe}from"./StockItemTable-bW53PHd8.js";import{D as je,B as w}from"./ColumnRenderers-g3zQL0h_.js";import"./ActionButton-DLsRvAT1.js";import"./DesktopAppView-DxQJo3T-.js";import"./index-dkDFLfDd.js";import"./QRCode-tr3h0Ayp.js";import"./browser-BL541dLs.js";import"./YesNoButton-DD4RFE30.js";import"./formatters-BZ5YEOyk.js";import"./ModelType-CaQkIuKb.js";import"./GenericErrorPage-DS07aljU.js";import"./NotFound-LPA9XMjd.js";import"./PermissionDenied-DglG0Y8V.js";import"./PageTitle-Cvnbh7U4.js";import"./PluginSource-CHMSfDB-.js";import"./RemoteComponent-C77F08TN.js";import"./RemoveRowButton-CcCl0sVr.js";import"./UseGenerator-CdxkBrcC.js";import"./OrderPartsWizard-CHxSYjNR.js";import"./CompanyForms-CQAVE0Ar.js";import"./PurchaseOrderForms-DPLnYzsw.js";function ye({parentId:p}){const s=Z("stocklocation"),d=N(),m=n.useMemo(()=>[{name:"cascade",label:t._({id:"VY386J"}),description:t._({id:"Ue7Vtx"})},{name:"structural",label:t._({id:"PRKZBP"}),description:t._({id:"zW8WBT"})},{name:"external",label:t._({id:"bVhrVt"}),description:t._({id:"ckSQBM"})},{name:"has_location_type",label:t._({id:"Sgyhpp"})},{name:"location_type",label:t._({id:"4sg5Qp"}),description:t._({id:"buIdz6"}),apiUrl:g(c.stock_location_type_list),model:i.stocklocationtype,modelRenderer:a=>a.name}],[]),S=n.useMemo(()=>[{accessor:"name",switchable:!1,render:a=>o.jsxs(B,{gap:"xs",children:[a.icon&&o.jsx(y,{name:a.icon}),a.name]})},je({}),{accessor:"pathstring",sortable:!0},{accessor:"items",sortable:!0},w({accessor:"structural",defaultVisible:!1}),w({accessor:"external",defaultVisible:!1}),{accessor:"location_type",sortable:!1,render:a=>{var r;return(r=a.location_type_detail)==null?void 0:r.name}}],[]),k=le({url:c.stock_location_list,title:t._({id:"sklcDg"}),fields:P(),focus:"name",initialData:{parent:p},follow:!0,modelType:i.stocklocation,table:s}),[e,b]=n.useState(-1),_=O({url:c.stock_location_list,pk:e,title:t._({id:"Qdjbg8"}),fields:P(),onFormSuccess:a=>s.updateRecord(a)}),f=re({url:c.stock_location_list,items:s.selectedIds,title:t._({id:"vqGtWs"}),fields:{parent:{}},onFormSuccess:s.refreshTable}),I=n.useMemo(()=>{const a=d.hasAddRole(u.stock_location),r=d.hasChangeRole(u.stock_location);return[o.jsx(H,{tooltip:t._({id:"Ego4rz"}),icon:o.jsx(A,{icon:"location"}),disabled:!s.hasSelectedRecords,actions:[{name:t._({id:"OORNPU"}),icon:o.jsx(A,{icon:"location"}),tooltip:t._({id:"dIzYVe"}),hidden:!r,disabled:!s.hasSelectedRecords,onClick:()=>{f.open()}}]}),o.jsx(de,{tooltip:t._({id:"sklcDg"}),onClick:()=>k.open(),hidden:!a},"add-stock-location")]},[d,s.hasSelectedRecords]),h=n.useCallback(a=>{const r=d.hasChangeRole(u.stock_location);return[$({hidden:!r,onClick:()=>{b(a.pk),_.open()}})]},[d]);return o.jsxs(o.Fragment,{children:[k.modal,_.modal,f.modal,o.jsx(ee,{url:g(c.stock_location_list),tableState:s,columns:S,props:{enableSelection:!0,enableDownload:!0,enableLabels:!0,enableReports:!0,params:{parent:p,top_level:p===void 0?!0:void 0},tableFilters:m,tableActions:I,rowActions:h,modelType:i.stocklocation}})]})}function st(){const{id:p}=K(),s=n.useMemo(()=>Number.isNaN(Number.parseInt(p||""))?void 0:p,[p]),d=X(),m=N(),[S,k]=n.useState(!1),{instance:e,refreshInstance:b,instanceQuery:_}=he({endpoint:c.stock_location_list,hasPrimaryKey:!0,pk:s,params:{path_detail:!0}}),f=n.useMemo(()=>{if(s&&_.isFetching)return o.jsx(U,{});const l=[{type:"text",name:"name",label:t._({id:"6YtxFj"}),copy:!0,value_formatter:()=>o.jsxs(B,{gap:"xs",children:[e.icon&&o.jsx(y,{name:e.icon}),e.name]})},{type:"text",name:"pathstring",label:t._({id:"I6gXOa"}),icon:"sitemap",copy:!0,hidden:!s},{type:"text",name:"description",label:t._({id:"Nu4oKW"}),copy:!0},{type:"link",name:"parent",model_field:"name",icon:"location",label:t._({id:"+o9hiJ"}),model:i.stocklocation,hidden:!(e!=null&&e.parent)}],x=[{type:"text",name:"items",icon:"stock",label:t._({id:"Jbck4N"}),value_formatter:()=>(e==null?void 0:e.items)||"0"},{type:"text",name:"sublocations",icon:"location",label:t._({id:"L7/8CO"}),hidden:!(e!=null&&e.sublocations)},{type:"boolean",name:"structural",label:t._({id:"PRKZBP"}),icon:"sitemap"},{type:"boolean",name:"external",label:t._({id:"bVhrVt"})},{type:"string",name:"location_type_detail.name",label:t._({id:"4sg5Qp"}),hidden:!(e!=null&&e.location_type),icon:"packages"}];return o.jsxs(ne,{children:[s&&(e!=null&&e.pk)?o.jsx(F,{item:e,fields:l}):o.jsx(W,{children:t._({id:"js9HzF"})}),s&&(e==null?void 0:e.pk)&&o.jsx(F,{item:e,fields:x})]})},[e,_]),I=n.useMemo(()=>[{name:"details",label:t._({id:"AC8C/Z"}),icon:o.jsx(q,{}),content:f},{name:"sublocations",label:s?t._({id:"L7/8CO"}):t._({id:"1eBWAw"}),icon:o.jsx(G,{}),content:o.jsx(ye,{parentId:s})},{name:"stock-items",label:t._({id:"Jbck4N"}),icon:o.jsx(L,{}),content:o.jsx(fe,{tableName:"location-stock",allowAdd:!0,params:{location:s}})},{name:"default_parts",label:t._({id:"D19W4x"}),icon:o.jsx(L,{}),hidden:!e.pk,content:o.jsx(xe,{props:{params:{default_location:e.pk}}})}],[e,s]),h=O({url:c.stock_location_list,pk:s,title:t._({id:"Qdjbg8"}),fields:P(),onFormSuccess:b}),a=n.useMemo(()=>[{value:0,display_name:t._({id:"+oqXDN"})},{value:1,display_name:t._({id:"lzGbCT"})}],[]),r=pe({url:c.stock_location_list,pk:s,title:t._({id:"lnETLa"}),fields:{delete_stock_items:{label:t._({id:"j3pJx8"}),description:t._({id:"Ml7+Iv"}),field_type:"choice",choices:a},delete_sub_location:{label:t._({id:"+DlcAh"}),description:t._({id:"CEDjmR"}),field_type:"choice",choices:a}},onFormSuccess:()=>{e.parent?d(M(i.stocklocation,e.parent)):d("/stock/")}}),V=n.useMemo(()=>({pk:e.pk,model:"location",refresh:b,filters:{in_stock:!0}}),[e]),C=be({formProps:V,enabled:!0,delete:!1,merge:!1,assign:!1}),T=E({title:t._({id:"XaNm5l"}),modelType:i.stockitem,callback:async(l,x)=>{const j=x.stockitem.instance;return v.post(g(c.stock_transfer),{location:e.pk,items:[{pk:j.pk,quantity:j.quantity}]}).then(()=>({success:t._({id:"vdb1YW"})})).catch(D=>(console.error("Error scanning stock item:",D),{error:t._({id:"TL3ZFM"})}))}}),R=E({title:t._({id:"ohwQub"}),modelType:i.stocklocation,callback:async(l,x)=>{const j=x.stocklocation.pk;return v.patch(g(c.stock_location_list,j),{parent:e.pk}).then(()=>({success:t._({id:"1OrE7V"})})).catch(D=>(console.error("Error scanning stock location:",D),{error:t._({id:"nFD3+9"})}))}}),z=n.useMemo(()=>[o.jsx(Y,{model:i.stocklocation,id:e.pk}),o.jsx(ke,{locationId:e.pk}),e.pk?o.jsx(te,{model:i.stocklocation,pk:e.pk,hash:e==null?void 0:e.barcode_hash,perm:m.hasChangeRole(u.stock_location),actions:[{name:"Scan in stock items",icon:o.jsx(A,{icon:"stock"}),tooltip:"Scan item into this location",onClick:T.open},{name:"Scan in container",icon:o.jsx(A,{icon:"unallocated_stock"}),tooltip:"Scan container into this location",onClick:R.open}]}):null,o.jsx(oe,{modelType:i.stocklocation,items:[e.pk??0],hidden:!(e!=null&&e.pk),enableLabels:!0,enableReports:!0}),C.dropdown,o.jsx(se,{tooltip:t._({id:"Ego4rz"}),actions:[ae({hidden:!s||!m.hasChangeRole(u.stock_location),tooltip:t._({id:"Qdjbg8"}),onClick:()=>h.open()}),ie({hidden:!s||!m.hasDeleteRole(u.stock_location),tooltip:t._({id:"lnETLa"}),onClick:()=>r.open()})]})],[e,s,m,C.dropdown]),Q=n.useMemo(()=>[{name:t._({id:"blbbPS"}),url:"/stock"},...(e.path??[]).map(l=>({name:l.name,url:M(i.stocklocation,l.pk),icon:l.icon?o.jsx(y,{name:l.icon}):void 0}))],[e]);return o.jsxs(o.Fragment,{children:[h.modal,r.modal,T.dialog,R.dialog,o.jsxs(ce,{query:_,requiredRole:u.stock_location,children:[o.jsxs(J,{children:[o.jsx(me,{title:t._({id:"1eBWAw"}),modelType:i.stocklocation,endpoint:c.stock_location_tree,opened:S,onClose:()=>k(!1),selectedId:e==null?void 0:e.pk}),o.jsx(ue,{title:(e==null?void 0:e.name)??s?t._({id:"adXdas"}):t._({id:"blbbPS"}),subtitle:e==null?void 0:e.description,icon:(e==null?void 0:e.icon)&&o.jsx(y,{name:e==null?void 0:e.icon}),actions:z,editAction:h.open,editEnabled:!!(e!=null&&e.pk)&&m.hasChangePermission(i.stocklocation),breadcrumbs:Q,lastCrumb:[{name:e.name,url:`/stock/location/${e.pk}/`}],breadcrumbAction:()=>{k(!0)}}),o.jsx(_e,{pageKey:"stocklocation",panels:I,model:i.stocklocation,reloadInstance:b,id:e==null?void 0:e.pk,instance:e})]}),C.modals.map(l=>l.modal)]})]})}export{st as default};
//# sourceMappingURL=LocationDetail-DstTcODn.js.map
