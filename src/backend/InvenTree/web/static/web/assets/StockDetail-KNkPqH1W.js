import{i as t,r as o,j as s,a8 as Le,cy as W,bP as we,G as B,B as J,bK as $,bT as be,by as Te,s as ke,I as Ve,as as We,bR as V,bS as Oe,H as he,eh as Ge,a4 as He,cI as Qe,dA as xe,a6 as Ye,bX as F,eH as Xe,eB as Je,eI as $e,ah as Ze,aV as et,b9 as tt,S as st,n as at}from"./vendor-COjCG5sX.js";import{A as it}from"./ActionButton-DLsRvAT1.js";import{b as ae,e as v,A as _,m as l,U as f,f as Ce,h as E}from"./index-ClP83spC.js";import{a as Re,q as lt,S as fe,x as nt,I as ye}from"./ThemeContext-B85sS1BU.js";import{A as ot}from"./AdminButton-DmZZOxW8.js";import{u as ie,I as le,R as rt,a as dt,Q as ct,U as ut,z as pt,P as mt,y as _t,O as bt,F as kt,E as ht,D as xt}from"./InvenTreeTable-BLgfUICM.js";import{I as ft,D as X,a as yt}from"./InstanceDetail-D0JUiPv3.js";import{D as C}from"./DetailsBadge-BpK5gh_H.js";import{D as jt,N as gt}from"./NotesPanel-2dK9X1T7.js";import{N as St}from"./NavigationTree-C5wV9DDo.js";import{P as At}from"./PageDetail-p6Y4q-h-.js";import{A as It}from"./AttachmentPanel-Be6kmD3E.js";import{P as vt}from"./PanelGroup-CYF3auDg.js";import{L as wt}from"./LocateItemButton-BZ31dqfp.js";import{b as O,g as Z,A as Me,q as De,u as Fe,a as Pe,E as je,h as qe,y as Tt,w as Ct,H as Rt,I as Mt,J as Dt,K as Ft,L as Pt}from"./UseForm-DUtLE7-5.js";import{O as qt}from"./OrderPartsWizard-CHxSYjNR.js";import{u as ze}from"./DesktopAppView-DxQJo3T-.js";import{f as ge,a as Se}from"./formatters-BZ5YEOyk.js";import{d as zt,e as Et,c as Ae,b as Bt,u as Ie,a as Ut,f as Kt}from"./UseStockAdjustActions-DrD9IiH8.js";import{u as ve}from"./UseInstance-CwLXxgXl.js";import{B as Nt}from"./BuildAllocatedStockTable-fogunTVD.js";import{S as Lt}from"./SalesOrderAllocationTable-iSJruf2u.js";import{P as Vt,S as Wt,D as Ee,N as Ot,k as Be}from"./ColumnRenderers-g3zQL0h_.js";import{S as Gt}from"./StockItemTable-bW53PHd8.js";import{W as Ht}from"./index-dkDFLfDd.js";import{P as Qt}from"./YesNoButton-DD4RFE30.js";import{A as Yt}from"./AttachmentLink-Bdm2Ykvd.js";import{R as Xt}from"./RowExpansionIcon-DiKqNCIG.js";import"./QRCode-tr3h0Ayp.js";import"./browser-BL541dLs.js";import"./ModelType-CaQkIuKb.js";import"./GenericErrorPage-DS07aljU.js";import"./NotFound-LPA9XMjd.js";import"./PermissionDenied-DglG0Y8V.js";import"./PageTitle-Cvnbh7U4.js";import"./PluginSource-CHMSfDB-.js";import"./RemoteComponent-C77F08TN.js";import"./CompanyForms-CQAVE0Ar.js";import"./PurchaseOrderForms-DPLnYzsw.js";import"./RemoveRowButton-CcCl0sVr.js";import"./UseGenerator-CdxkBrcC.js";import"./BuildForms-DlhAzCk8.js";import"./SalesOrderForms-DcYGKL77.js";function Jt({stockItem:c}){var w;const d=ie("stock_item_install"),p=ae(),j=zt({stockItem:c}),u=O({url:v(_.stock_install),pk:c.pk,title:t._({id:"erPDED"}),table:d,successMessage:t._({id:"g+zcGQ"}),fields:j}),[A,k]=o.useState({}),n=Et(),e=O({url:v(_.stock_uninstall),pk:A.pk,title:t._({id:"q2BZiX"}),table:d,successMessage:t._({id:"ibtYlF"}),fields:n,initialData:{location:c.location??((w=c.part_detail)==null?void 0:w.default_location)}}),h=o.useMemo(()=>[Vt({part:"part_detail"}),{accessor:"quantity",switchable:!1,render:x=>{let R=Z(x.quantity);return x.serial&&x.quantity==1&&(R=`# ${x.serial}`),R}},{accessor:"batch",switchable:!1},Wt({model:l.stockitem})],[]),I=o.useMemo(()=>{var x;return[s.jsx(Me,{tooltip:t._({id:"erPDED"}),onClick:()=>{u.open()},hidden:!p.hasChangeRole(f.stock)||c.is_building||((x=c.part_detail)==null?void 0:x.assembly)!=!0},"install")]},[c,p]),y=o.useCallback(x=>[{title:t._({id:"fo0VXg"}),tooltip:t._({id:"mGSvSz"}),onClick:()=>{k(x),e.open()},icon:s.jsx(Le,{}),hidden:!p.hasChangeRole(f.stock)}],[p]);return s.jsxs(s.Fragment,{children:[u.modal,e.modal,c.pk?s.jsx(le,{url:v(_.stock_item_list),tableState:d,columns:h,props:{tableActions:I,enableSelection:!0,enableLabels:!0,enableReports:!0,rowActions:y,modelType:l.stockitem,params:{belongs_to:c.pk,part_detail:!0}}}):s.jsx(W,{})]})}function $t({partId:c,itemId:d}){const p=ze(),j=ae(),u=ie("stocktests"),A=Ce(),k=o.useMemo(()=>A.isSet("TEST_STATION_DATA"),[A]),{data:n}=we({queryKey:["stocktesttemplates",c,d],queryFn:async()=>c?p.get(v(_.part_test_template_list),{params:{part:c,include_inherited:!0,enabled:!0}}).then(r=>r.data):[]});o.useEffect(()=>{u.refreshTable()},[n]);const e=o.useCallback(r=>{const a=(n==null?void 0:n.map(b=>({...b,templateId:b.pk,results:[]})))??[];return r.forEach(b=>{a.find(g=>g.templateId==b.template)||a.push({...b.template_detail,templateId:b.template,results:[]})}),r.sort((b,g)=>b.pk>g.pk?1:-1).forEach(b=>{const g=a.findIndex(D=>D.templateId==b.template);g>=0&&(a[g]={...a[g],...b},a[g].results.push(b))}),a},[c,d,n]),h=o.useCallback(r=>[{accessor:"test",title:t._({id:"NnH3pK"}),switchable:!1,sortable:!0,render:a=>{var Q,N;const b=a.enabled??((Q=a.template_detail)==null?void 0:Q.enabled),g=a.stock_item!=null&&a.stock_item!=d,D=a.results&&a.results.length>1;return s.jsxs(B,{justify:"space-between",wrap:"nowrap",children:[!r&&s.jsx(Xt,{enabled:D,expanded:u.isRowExpanded(a.pk)}),s.jsxs(J,{style:{fontStyle:g?"italic":void 0},c:b?void 0:"red",children:[!a.templateId&&"- ",a.test_name??((N=a.template_detail)==null?void 0:N.test_name)]}),s.jsxs(B,{justify:"right",children:[a.results&&a.results.length>1&&s.jsx($,{label:t._({id:"isbwWo"}),children:s.jsx(be,{color:"lightblue",variant:"filled",children:a.results.length})}),g&&s.jsx($,{label:t._({id:"yd1WJ/"}),children:s.jsx(Te,{size:16,color:"blue"})})]})]})}},{accessor:"result",title:t._({id:"RD6AE9"}),switchable:!1,sortable:!0,render:a=>a.result===void 0?s.jsx(be,{color:"lightblue",variant:"filled",children:t._({id:"4bobEy"})}):s.jsx(Qt,{value:a.result})},Ee({}),{accessor:"value",title:t._({id:"wMHvYH"})},{accessor:"attachment",title:t._({id:"UY1vmE"}),render:a=>a.attachment&&s.jsx(Yt,{attachment:a.attachment}),noContext:!0},Ot({}),Be({}),{accessor:"user",title:t._({id:"7PzzBU"}),sortable:!1,render:a=>a.user_detail&&s.jsx(De,{instance:a.user_detail})},{accessor:"test_station",sortable:!0,title:t._({id:"18Lf3c"}),hidden:!k},{accessor:"started_datetime",sortable:!0,title:t._({id:"JEGlfK"}),hidden:!k,render:a=>s.jsx(B,{justify:"space-between",children:ge(a.started_datetime,{showTime:!0,showSeconds:!0})})},{accessor:"finished_datetime",sortable:!0,title:t._({id:"4dQFvz"}),hidden:!k,render:a=>s.jsx(B,{justify:"space-between",children:ge(a.finished_datetime,{showTime:!0,showSeconds:!0})})}],[d,k,u.expandedRecords]),I=o.useMemo(()=>h(!1),[d,k,u.expandedRecords]),[y,w]=o.useState(void 0),x=Ae({partId:c,itemId:d,templateId:y,editing:!1}),R=Ae({partId:c,itemId:d,templateId:y,editing:!0}),M=O({url:_.stock_test_result_list,fields:o.useMemo(()=>({...x}),[x]),initialData:{template:y,result:!0},title:t._({id:"VzkBcq"}),table:u,successMessage:t._({id:"VivtT0"})}),[P,q]=o.useState(0),U=Fe({url:_.stock_test_result_list,pk:P,fields:o.useMemo(()=>({...R}),[R]),title:t._({id:"1HKt5e"}),onFormSuccess:()=>u.refreshTable,successMessage:t._({id:"G0v/SO"})}),G=Pe({url:_.stock_test_result_list,pk:P,title:t._({id:"381PhV"}),table:u,successMessage:t._({id:"xbuMqN"})}),ee=o.useCallback(r=>{p.post(v(_.stock_test_result_list),{template:r,stock_item:d,result:!0}).then(()=>{u.refreshTable(),ke({title:t._({id:"uUlW4e"}),message:t._({id:"uiR3yF"}),color:"green"})}).catch(()=>{ke({title:t._({id:"SlfejT"}),message:t._({id:"VjER3N"}),color:"red"})})},[d]),H=o.useCallback(r=>r.stock_item!=null&&r.stock_item!=d?[]:[{title:t._({id:"up/ozE"}),color:"green",icon:s.jsx(Ve,{}),hidden:!r.templateId||(r==null?void 0:r.requires_attachment)||(r==null?void 0:r.requires_value)||r.result,onClick:()=>ee(r.templateId)},{title:t._({id:"m16xKo"}),tooltip:t._({id:"VzkBcq"}),color:"green",icon:s.jsx(We,{}),hidden:!j.hasAddRole(f.stock)||!r.templateId,onClick:()=>{w(r.templateId),M.open()}},rt({tooltip:t._({id:"1HKt5e"}),hidden:!j.hasChangeRole(f.stock)||!r.template_detail,onClick:()=>{q(r.pk),U.open()}}),dt({tooltip:t._({id:"381PhV"}),hidden:!j.hasDeleteRole(f.stock)||!r.template_detail,onClick:()=>{q(r.pk),G.open()}})],[j,d]),K=o.useMemo(()=>[{name:"required",label:t._({id:"TMLAx2"}),description:t._({id:"sKK8za"})},{name:"include_installed",label:t._({id:"TD72EF"}),description:t._({id:"BYeSw1"})},{name:"result",label:t._({id:"nqMwPi"}),description:t._({id:"bcwRe2"})},{name:"enabled",label:t._({id:"RxzN1M"}),description:t._({id:"+kMQXd"})}],[]),te=o.useMemo(()=>[s.jsx(Me,{tooltip:t._({id:"VzkBcq"}),onClick:()=>{w(void 0),M.open()},hidden:!j.hasAddRole(f.stock)},"add-test-result")],[j]),se=o.useMemo(()=>{const r=[...h(!0),{accessor:"actions",title:"  ",hidden:!1,switchable:!1,width:50,render:a=>s.jsx(ct,{actions:H(a)??[]})}];return{allowMultiple:!0,expandable:({record:a})=>u.isRowExpanded(a.pk)||a.results&&a.results.length>1,content:({record:a})=>{if(!a||!a.results||a.results.length<2)return null;const b=(a==null?void 0:a.results)??[];return s.jsx(Ht,{idAccessor:"test",noHeader:!0,columns:r,records:b.slice(0,-1)},a.pk)}}},[h,u.isRowExpanded]);return s.jsxs(s.Fragment,{children:[M.modal,U.modal,G.modal,s.jsx(le,{url:v(_.stock_test_result_list),tableState:u,columns:I,props:{dataFormatter:e,enablePagination:!1,tableActions:te,tableFilters:K,rowActions:H,rowExpansion:se,params:{stock_item:d,user_detail:!0,attachment_detail:!0,template_detail:!0}}})]})}function Zt({itemId:c}){const d=Re(),p=ie("stock_tracking"),j=o.useCallback(k=>{const n=(k==null?void 0:k.deltas)??{},e=[{label:t._({id:"igx8Og"}),key:"stockitem",details:n.stockitem_detail&&je({instance:n.stockitem_detail,link:!0})},{label:t._({id:"igx8Og"}),key:"item",details:n.item_detail&&je({instance:n.item_detail,link:!0})},{label:t._({id:"uAQUqI"}),key:"status",details:n.status&&qe({status:n.status,type:l.stockitem})},{label:t._({id:"VbWX2u"}),key:"quantity",details:Z(n.quantity)},{label:t._({id:"hp8OtS"}),key:"added",details:n.added},{label:t._({id:"eps54V"}),key:"removed",details:n.removed},{label:t._({id:"vgP+9p"}),key:"part",details:n.part_detail&&Tt({instance:n.part_detail,link:!0,navigate:d})},{label:t._({id:"wJijgU"}),key:"location",details:n.location_detail&&Ct({instance:n.location_detail,link:!0,navigate:d})},{label:t._({id:"YxwWvi"}),key:"buildorder",details:n.buildorder_detail&&Rt({instance:n.buildorder_detail,link:!0,navigate:d})},{label:t._({id:"KxySMG"}),key:"purchaseorder",details:n.purchaseorder_detail&&Mt({instance:n.purchaseorder_detail,link:!0,navigate:d})},{label:t._({id:"LozYBo"}),key:"salesorder",details:n.salesorder_detail&&Dt({instance:n.salesorder_detail,link:!0,navigate:d})},{label:t._({id:"Z6ve1w"}),key:"returnorder",details:n.returnorder_detail&&Ft({instance:n.returnorder_detail,link:!0,navigate:d})},{label:t._({id:"876pfE"}),key:"customer",details:n.customer_detail&&Pt({instance:n.customer_detail,link:!0,navigate:d})}];return s.jsx(V,{striped:!0,children:s.jsx(V.Tbody,{children:e.map(h=>h.details&&s.jsxs(V.Tr,{children:[s.jsx(V.Td,{children:s.jsx(J,{children:h.label})}),s.jsx(V.Td,{children:h.details})]},h.key))})})},[d]),u=o.useMemo(()=>[ut({name:"user",label:t._({id:"7PzzBU"}),description:t._({id:"FVjW63"})})],[]),A=o.useMemo(()=>[Be({switchable:!1}),Ee({accessor:"label"}),{accessor:"details",title:t._({id:"URmyfc"}),switchable:!1,render:j},{accessor:"notes",title:t._({id:"1DBGsz"}),sortable:!1,switchable:!0},{accessor:"user",title:t._({id:"7PzzBU"}),render:k=>k.user_detail?De({instance:k.user_detail}):s.jsx(J,{size:"sm",fs:"italic",children:t._({id:"L5d7xh"})})}],[]);return s.jsx(le,{tableState:p,url:v(_.stock_tracking_list),columns:A,props:{params:{item:c,user_detail:!0},enableDownload:!0,tableFilters:u}})}function Vs(){var re,de,ce,ue;const{id:c}=lt(),d=ze(),p=ae(),j=Ce(),u=o.useMemo(()=>j.isSet("STOCK_ENABLE_EXPIRY"),[j]),A=Re(),[k,n]=o.useState(!1),{instance:e,refreshInstance:h,instanceQuery:I}=ve({endpoint:_.stock_item_list,pk:c,params:{part_detail:!0,location_detail:!0,path_detail:!0}}),{instance:y,instanceQuery:w}=ve({endpoint:_.stock_serial_info,pk:c}),x=Bt({partId:e.part}),R=o.useMemo(()=>{var pe,me;const i={...e},m=(e==null?void 0:e.part_detail)??{};if(i.available_stock=Math.max(0,i.quantity-i.allocated),I.isFetching)return s.jsx(W,{});const T=[{name:"part",label:t._({id:"mY+KgP"}),type:"link",model:l.part},{name:"part_detail.IPN",label:t._({id:"3wXEsN"}),type:"text",copy:!0,icon:"part",hidden:!m.IPN},{name:"part_detail.revision",label:t._({id:"6LTyxl"}),type:"string",copy:!0,icon:"revision",hidden:!m.revision},{name:"status",type:"status",label:t._({id:"uAQUqI"}),model:l.stockitem},{name:"status_custom_key",type:"status",label:t._({id:"4DvUAJ"}),model:l.stockitem,icon:"status",hidden:!e.status_custom_key||e.status_custom_key==e.status},{type:"link",name:"link",label:t._({id:"yzF66j"}),external:!0,copy:!0,hidden:!e.link}],z=[{type:"text",name:"serial",label:t._({id:"AXeJt4"}),hidden:!e.serial,value_formatter:()=>{var S,L;return s.jsxs(B,{gap:"xs",justify:"space-apart",children:[s.jsx(J,{children:e.serial}),s.jsx(Oe,{flex:10}),s.jsxs(B,{gap:2,justify:"right",children:[((S=y.previous)==null?void 0:S.pk)&&s.jsx($,{label:t._({id:"6nb2iE"}),position:"top",children:s.jsx(he,{p:3,"aria-label":"previous-serial-number",leftSection:s.jsx(Ge,{}),variant:"transparent",size:"sm",onClick:()=>{A(E(l.stockitem,y.previous.pk))},children:y.previous.serial})}),s.jsx(it,{icon:s.jsx(He,{size:18}),tooltip:t._({id:"jfMcvL"}),tooltipAlignment:"top",variant:"transparent",onClick:x.open}),((L=y.next)==null?void 0:L.pk)&&s.jsx($,{label:t._({id:"TVYdHj"}),position:"top",children:s.jsx(he,{p:3,"aria-label":"next-serial-number",rightSection:s.jsx(Qe,{}),variant:"transparent",size:"sm",onClick:()=>{A(E(l.stockitem,y.next.pk))},children:y.next.serial})})]})]})}},{type:"number",name:"quantity",label:t._({id:"VbWX2u"}),unit:m==null?void 0:m.units,hidden:!!e.serial&&e.quantity==1},{type:"number",name:"available_stock",label:t._({id:"csDS2L"}),unit:m==null?void 0:m.units,icon:"stock"},{type:"number",name:"allocated",label:t._({id:"8oSGoC"}),unit:m==null?void 0:m.units,icon:"tick_off",hidden:!e.allocated},{type:"text",name:"batch",label:t._({id:"Vea6Aj"}),hidden:!e.batch}],Y=[{name:"supplier_part",label:t._({id:"nne72x"}),type:"link",model_field:"SKU",model:l.supplierpart,hidden:!e.supplier_part},{type:"link",name:"location",label:t._({id:"wJijgU"}),model:l.stocklocation,hidden:!e.location},{type:"link",name:"belongs_to",label:t._({id:"QPoAhl"}),model_filters:{part_detail:!0},model_formatter:S=>{var _e;let L=((_e=S==null?void 0:S.part_detail)==null?void 0:_e.full_name)??(S==null?void 0:S.name);return S.serial&&S.quantity==1&&(L+=` # ${S.serial}`),L},icon:"stock",model:l.stockitem,hidden:!e.belongs_to},{type:"link",name:"parent",icon:"sitemap",label:t._({id:"0o0T0n"}),model:l.stockitem,hidden:!e.parent,model_formatter:S=>t._({id:"94QKKW"})},{type:"link",name:"consumed_by",label:t._({id:"H00rnl"}),model:l.build,hidden:!e.consumed_by,icon:"build",model_field:"reference"},{type:"link",name:"build",label:t._({id:"YxwWvi"}),model:l.build,hidden:!e.build,model_field:"reference"},{type:"link",name:"purchase_order",label:t._({id:"KxySMG"}),model:l.purchaseorder,hidden:!e.purchase_order,icon:"purchase_orders",model_field:"reference"},{type:"link",name:"sales_order",label:t._({id:"LozYBo"}),model:l.salesorder,hidden:!e.sales_order,icon:"sales_orders",model_field:"reference"},{type:"link",name:"customer",label:t._({id:"876pfE"}),model:l.company,hidden:!e.customer}],Ne=[{type:"date",name:"expiry_date",label:t._({id:"uaSvqt"}),hidden:!u||!e.expiry_date,icon:"calendar"},{type:"text",name:"purchase_price",label:t._({id:"vWelsN"}),icon:"currency",hidden:!e.purchase_price,value_formatter:()=>Se(e.purchase_price,{currency:e.purchase_price_currency})},{type:"text",name:"stock_value",label:t._({id:"g9RfVq"}),icon:"currency",hidden:!e.purchase_price||e.quantity==1||e.quantity==0,value_formatter:()=>Se(e.purchase_price,{currency:e.purchase_price_currency,multiplier:e.quantity})},{type:"text",name:"packaging",icon:"part",label:t._({id:"pD/Ew0"}),hidden:!e.packaging},{type:"text",name:"updated",icon:"calendar",label:t._({id:"K7P0jz"})},{type:"text",name:"stocktake",icon:"calendar",label:t._({id:"whZ7zT"}),hidden:!e.stocktake}];return s.jsxs(ft,{children:[s.jsxs(xe,{grow:!0,children:[s.jsx(jt,{appRole:f.part,apiPath:_.part_list,src:((pe=e.part_detail)==null?void 0:pe.image)??((me=e==null?void 0:e.part_detail)==null?void 0:me.thumbnail),pk:e.part}),s.jsx(xe.Col,{span:{base:12,sm:8},children:s.jsx(X,{fields:T,item:i})})]}),s.jsx(X,{fields:z,item:i}),s.jsx(X,{fields:Y,item:i}),s.jsx(X,{fields:Ne,item:i})]})},[e,y,w.isFetching,I.isFetching,u]),M=o.useMemo(()=>{var i;return((i=e==null?void 0:e.part_detail)==null?void 0:i.component)&&!(e!=null&&e.sales_order)&&!(e!=null&&e.belongs_to)},[e]),P=o.useMemo(()=>{var i;return(i=e==null?void 0:e.part_detail)==null?void 0:i.salable},[e]),q=we({queryKey:["tracked-bom-item",e.pk,e.part],queryFn:()=>{var i;return!e.pk||!e.part||!((i=e.part_detail)!=null&&i.assembly)?!1:d.get(v(_.bom_list),{params:{part:e.part,sub_part_trackable:!0,limit:1}}).then(m=>m.status==200?m.data.count>0:null)}}),U=o.useMemo(()=>{var i;return e!=null&&e.installed_items?!0:q.data?q.data:(i=e==null?void 0:e.part_detail)==null?void 0:i.assembly},[q,e]),G=o.useMemo(()=>{var i;return[{name:"details",label:t._({id:"hBG+yp"}),icon:s.jsx(Te,{}),content:R},{name:"tracking",label:t._({id:"IdrYoA"}),icon:s.jsx(Ye,{}),content:e.pk?s.jsx(Zt,{itemId:e.pk}):s.jsx(W,{})},{name:"allocations",label:t._({id:"KwhnxF"}),icon:s.jsx(Xe,{}),hidden:!e.in_stock||!P&&!M,content:s.jsxs(F,{multiple:!0,defaultValue:["buildAllocations","salesAllocations"],children:[M&&s.jsxs(F.Item,{value:"buildAllocations",children:[s.jsx(F.Control,{children:s.jsx(fe,{size:"lg",children:t._({id:"KCpl4N"})})}),s.jsx(F.Panel,{children:s.jsx(Nt,{stockId:e.pk,modelField:"build",modelTarget:l.build,showBuildInfo:!0})})]},"buildAllocations"),P&&s.jsxs(F.Item,{value:"salesAllocations",children:[s.jsx(F.Control,{children:s.jsx(fe,{size:"lg",children:t._({id:"DaWMWw"})})}),s.jsx(F.Panel,{children:s.jsx(Lt,{stockId:e.pk,modelField:"order",modelTarget:l.salesorder,showOrderInfo:!0})})]},"salesAllocations")]})},{name:"test-results",label:t._({id:"isbwWo"}),icon:s.jsx(Je,{}),hidden:!((i=e==null?void 0:e.part_detail)!=null&&i.testable),content:e!=null&&e.pk?s.jsx($t,{itemId:e.pk,partId:e.part}):s.jsx(W,{})},{name:"installed_items",label:t._({id:"xnskHi"}),icon:s.jsx($e,{}),hidden:!U,content:s.jsx(Jt,{stockItem:e})},{name:"child_items",label:t._({id:"K4v96J"}),icon:s.jsx(Ze,{}),hidden:((e==null?void 0:e.child_items)??0)==0,content:e!=null&&e.pk?s.jsx(Gt,{tableName:"child-stock",params:{ancestor:e.pk}}):s.jsx(W,{})},It({model_type:l.stockitem,model_id:e.pk}),gt({model_type:l.stockitem,model_id:e.pk})]},[P,M,U,e,y,w,c,p]),ee=o.useMemo(()=>[{name:t._({id:"blbbPS"}),url:"/stock"},...(e.location_path??[]).map(i=>({name:i.name,url:E(l.stocklocation,i.pk)}))],[e]),H=Ie({create:!1,stockItem:e,partId:e.part,modalId:"edit-stock-item"}),K=Fe({url:_.stock_item_list,pk:e.pk,title:t._({id:"gQgYNs"}),modalId:"edit-stock-item",fields:H,onFormSuccess:h}),te=Ie({create:!0,modalId:"duplicate-stock-item"}),se=o.useMemo(()=>{const i={...e,serial_numbers:e.serial};return delete i.serial,i},[e]),r=O({url:_.stock_item_list,title:t._({id:"bJLEQT"}),modalId:"duplicate-stock-item",fields:te,initialData:{...se},follow:!0,successMessage:null,modelType:l.stockitem,onFormSuccess:i=>{var m;if(Array.isArray(i)&&i.length>0)if(i.length==1)A(E(l.stockitem,(m=i[0])==null?void 0:m.pk));else{const T=i.length;at.show({title:t._({id:"7Vas0a"}),message:t._({id:"DHdcSX",values:{n:T}}),color:"green"})}}}),a=o.useMemo(()=>{},[e]),b=Pe({url:_.stock_item_list,pk:e.pk,title:t._({id:"BJoa27"}),preFormContent:a,onFormSuccess:()=>{A(E(l.part,e.part))}}),g=o.useMemo(()=>({items:[e],model:l.stockitem,refresh:h,filters:{in_stock:!0}}),[e]),D=Ut({formProps:g,delete:!1,assign:!!e.in_stock,return:!!e.consumed_by||!!e.customer,merge:!1}),Q=Kt({partId:e.part,trackable:(re=e.part_detail)==null?void 0:re.trackable,modalId:"stock-item-serialize"}),N=O({url:_.stock_serialize,pk:e.pk,title:t._({id:"ETKLHa"}),modalId:"stock-item-serialize",fields:Q,initialData:{quantity:e.quantity,destination:e.location??((de=e.part_detail)==null?void 0:de.default_location)},onFormSuccess:i=>{i.length>=e.quantity?A(E(l.stockitem,i[0].pk)):h()},successMessage:t._({id:"Hkw/xj"})}),ne=qt({parts:e.part_detail?[e.part_detail]:[]}),oe=nt({title:t._({id:"kiz1mM"}),modelType:l.stocklocation,callback:async(i,m)=>{const T=m.stocklocation.pk;return d.post(v(_.stock_transfer),{location:T,items:[{pk:e.pk,quantity:e.quantity}]}).then(()=>(h(),{success:t._({id:"vdb1YW"})})).catch(z=>(console.log("Error scanning stock item:",z),{error:t._({id:"TL3ZFM"})}))}}),Ue=o.useMemo(()=>{var T,z,Y;p.hasChangeRole(f.stock)&&!e.sales_order&&!e.belongs_to&&!e.customer&&e.consumed_by,e.is_building;const i=e.serial,m=i!=null&&i!=null&&i!=""&&e.quantity==1;return[s.jsx(ot,{model:l.stockitem,id:e.pk}),s.jsx(wt,{stockId:e.pk}),s.jsx(pt,{model:l.stockitem,pk:e.pk,hash:e==null?void 0:e.barcode_hash,perm:p.hasChangeRole(f.stock),actions:[{name:t._({id:"MeG2ih"}),icon:s.jsx(ye,{icon:"location"}),tooltip:t._({id:"8Otzst"}),onClick:oe.open}]}),s.jsx(mt,{modelType:l.stockitem,items:[e.pk],enableReports:!0,enableLabels:!0}),s.jsx(_t,{tooltip:t._({id:"ClJC3x"}),icon:s.jsx(tt,{}),actions:[...D.menuActions,{name:t._({id:"Wlr+mY"}),tooltip:t._({id:"Vmnyam"}),hidden:m||(e==null?void 0:e.quantity)<1||((T=e==null?void 0:e.part_detail)==null?void 0:T.trackable)!=!0,icon:s.jsx(ye,{icon:"serial",iconProps:{color:"blue"}}),onClick:()=>{N.open()}},{name:t._({id:"UYUgdb"}),tooltip:t._({id:"cUzrZK"}),hidden:!p.hasAddRole(f.purchase_order)||!((z=e.part_detail)!=null&&z.active)||!((Y=e.part_detail)!=null&&Y.purchaseable),icon:s.jsx(et,{color:"blue"}),onClick:()=>{ne.openWizard()}}]}),s.jsx(bt,{tooltip:t._({id:"oPF3fX"}),actions:[kt({hidden:!p.hasAddRole(f.stock),onClick:()=>r.open()}),ht({hidden:!p.hasChangeRole(f.stock),onClick:()=>K.open()}),xt({hidden:!p.hasDeleteRole(f.stock),onClick:()=>b.open()})]})]},[c,e,p,D.menuActions]),Ke=o.useMemo(()=>{let i=((e==null?void 0:e.quantity)??0)-((e==null?void 0:e.allocated)??0);return i=Math.max(0,i),I.isLoading?[]:[s.jsx(C,{color:"yellow",label:t._({id:"BE5Q6v"}),visible:e.is_building}),s.jsx(C,{color:"blue",label:`${t._({id:"AXeJt4"})}: ${e.serial}`,visible:!!e.serial},"serial"),s.jsx(C,{color:"blue",label:`${t._({id:"VbWX2u"})}: ${Z(e.quantity)}`,visible:!e.serial},"quantity"),s.jsx(C,{color:"yellow",label:`${t._({id:"csDS2L"})}: ${Z(i)}`,visible:e.in_stock&&!e.serial&&i!=e.quantity},"available"),s.jsx(C,{color:"blue",label:`${t._({id:"Vea6Aj"})}: ${e.batch}`,visible:!!e.batch},"batch"),s.jsx(qe,{status:e.status_custom_key||e.status,type:l.stockitem,options:{size:"lg"}},"status"),s.jsx(C,{color:"yellow",label:t._({id:"1ba70W"}),visible:u&&e.stale&&!e.expired},"stale"),s.jsx(C,{color:"orange",label:t._({id:"M1RnFv"}),visible:u&&e.expired},"expired"),s.jsx(C,{color:"red",label:t._({id:"jqzUyM"}),visible:e.in_stock==!1},"unavailable")]},[e,I,u]);return s.jsxs(s.Fragment,{children:[x.modal,oe.dialog,s.jsx(yt,{query:I,requiredPermission:l.stockitem,children:s.jsxs(st,{children:[p.hasViewRole(f.stock_location)&&s.jsx(St,{title:t._({id:"1eBWAw"}),modelType:l.stocklocation,endpoint:_.stock_location_tree,opened:k,onClose:()=>n(!1),selectedId:e==null?void 0:e.location}),s.jsx(At,{title:t._({id:"igx8Og"}),subtitle:(ce=e.part_detail)==null?void 0:ce.full_name,imageUrl:(ue=e.part_detail)==null?void 0:ue.thumbnail,editAction:K.open,editEnabled:p.hasChangePermission(l.stockitem),badges:Ke,breadcrumbs:p.hasViewRole(f.stock_location)?ee:void 0,lastCrumb:[{name:e.name,url:`/stock/item/${e.pk}/`}],breadcrumbAction:()=>{n(!0)},actions:Ue}),s.jsx(vt,{pageKey:"stockitem",panels:G,model:l.stockitem,id:e.pk,instance:e})]})}),K.modal,r.modal,b.modal,N.modal,D.modals.map(i=>i.modal),ne.wizard]})}export{Vs as default};
//# sourceMappingURL=StockDetail-KNkPqH1W.js.map
