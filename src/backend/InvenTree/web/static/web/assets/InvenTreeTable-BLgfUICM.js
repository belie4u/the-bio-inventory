import{c0 as ln,r,s as Le,bP as J,j as n,i as t,n as Z,d as Oe,I as an,dv as cn,bz as Be,bc as he,ae as Ie,cx as v,cO as ae,bK as P,H as ee,cz as dn,aA as ze,aG as un,a8 as mn,dD as fn,dE as pn,au as hn,cI as Pe,bL as U,aw as gn,bl as xn,b$ as _n,K as Cn,cJ as jn,c6 as He,cZ as qe,a4 as yn,dF as bn,bQ as ge,cM as Fn,cF as kn,bS as Ue,S as Y,B as V,Y as Ve,G as Q,bT as wn,c1 as Ne,aB as Tn,bV as Re,ct as vn,bd as An,dd as oe,dG as In,dH as Rn,F as En}from"./vendor-COjCG5sX.js";import{u as xe,a as Mn}from"./DesktopAppView-DxQJo3T-.js";import{e as L,A as O,d as Dn,C as Ee,o as Ge,f as _e,a as Sn,h as ce,n as de,p as ne,m as N,y as Ln,z as ue,u as On,E as Me}from"./index-ClP83spC.js";import{I as Ke,r as Bn,S as Ce,k as me,t as zn,a as Pn,v as Hn}from"./ThemeContext-B85sS1BU.js";import{P as De,C as qn,W as Un}from"./index-dkDFLfDd.js";import{b as fe,e as je,d as Vn,D as Nn,S as Gn,a as Kn,m as Qn}from"./UseForm-DUtLE7-5.js";import{A as Yn}from"./ActionButton-DLsRvAT1.js";import{I as $n,Q as Xn,a as Jn}from"./QRCode-tr3h0Ayp.js";function pe({title:s,id:e}){const i=xe(),c=ln(),[o,u]=r.useState(!1);r.useEffect(()=>{e?(u(!0),Le({id:`data-output-${e}`,title:s,loading:!0,autoClose:!1,withCloseButton:!1,message:n.jsx(De,{size:"lg",value:0,progressLabel:!0})})):u(!1)},[e,s]),J({enabled:!!e&&o&&c==="visible",refetchInterval:500,queryKey:["data-output",e,s],queryFn:()=>i.get(L(O.data_output,e)).then(p=>{var _;const f=(p==null?void 0:p.data)??{};if(f.errors||f.error){u(!1);const l=(f==null?void 0:f.error)??((_=f==null?void 0:f.errors)==null?void 0:_.error)??t._({id:"gzjOvt"});Z.update({id:`data-output-${e}`,loading:!1,icon:n.jsx(Oe,{}),autoClose:2500,title:s,message:l,color:"red"})}else if(f.complete){if(u(!1),Z.update({id:`data-output-${e}`,loading:!1,autoClose:2500,title:s,message:t._({id:"TCOQbo"}),color:"green",icon:n.jsx(an,{})}),f.output){const l=Dn(f.output);window.open(l.toString(),"_blank")}}else Z.update({id:`data-output-${e}`,loading:!0,autoClose:!1,withCloseButton:!1,message:n.jsx(De,{size:"lg",maximum:f.total,value:f.progress,progressLabel:f.total>0,animated:!0})});return f}).catch(()=>(u(!1),Z.update({id:`data-output-${e}`,loading:!1,autoClose:2500,title:s,message:t._({id:"gzjOvt"}),color:"red"}),{}))})}function ye({icon:s,tooltip:e,tooltipPosition:i,actions:c,disabled:o=!1,hidden:u=!1,noindicator:p=!1}){const f=r.useMemo(()=>c.some(h=>!h.hidden),[c]),_=r.useMemo(()=>c.find(h=>h.indicator),[c]),l=r.useMemo(()=>Ee(`action-menu-${e}`),[e]);return!u&&f?n.jsxs(v,{position:"bottom-end",children:[n.jsx(ae,{disabled:!_,..._==null?void 0:_.indicator,children:n.jsx(v.Target,{children:n.jsx(P,{label:e,hidden:!e,position:i??"bottom",children:n.jsx(ee,{variant:p?"transparent":"light",disabled:o,"aria-label":l,p:"0",size:"sm",rightSection:p?null:n.jsx(dn,{stroke:1.5}),styles:{section:{margin:0}},children:s})})})}),n.jsx(v.Dropdown,{children:c.map(h=>{const k=Ee(`${l}-${h.name}`);return h.hidden?null:r.createElement(ae,{disabled:!h.indicator,...h.indicator,key:h.name},n.jsx(P,{label:h.tooltip,hidden:!h.tooltip,position:"left",children:n.jsx(v.Item,{"aria-label":k,leftSection:h.icon,onClick:h.onClick,disabled:h.disabled,children:h.name})}))})})]},l):null}function Ft({actions:s=[],tooltip:e=t._({id:"0zpgxV"}),hidden:i=!1}){return n.jsx(ye,{icon:n.jsx(cn,{}),tooltip:e,actions:s,hidden:i,noindicator:!0})}function kt({model:s,pk:e,hash:i=null,actions:c=[],perm:o=!0}){const u=i===null,p={model:s,pk:e,hash:i};return n.jsx(ye,{tooltip:t._({id:"heU0Hk"}),icon:n.jsx(Ie,{}),actions:[le({mdl_prop:p,title:t._({id:"mYTVOy"}),icon:n.jsx(Ie,{}),tooltip:t._({id:"PuPuVa"}),ChildItem:$n}),le({hidden:u||i||!o,mdl_prop:p,title:t._({id:"3Bbgw2"}),icon:n.jsx(un,{}),tooltip:t._({id:"utafdp"}),ChildItem:Xn}),le({hidden:u||!i||!o,mdl_prop:p,title:t._({id:"ut1J8k"}),icon:n.jsx(mn,{}),tooltip:t._({id:"AlfG1i"}),ChildItem:Jn}),...c]})}function le({hidden:s=!1,mdl_prop:e,title:i,icon:c,tooltip:o,ChildItem:u}){return{icon:c,name:i,tooltip:o,onClick:()=>{Bn.open({title:n.jsx(Ce,{size:"xl",children:i}),children:n.jsx(u,{mdl_prop:e})})},hidden:s}}function wt(s){return{...s,icon:n.jsx(Be,{color:"blue"}),name:t._({id:"ePK91l"}),tooltip:s.tooltip??t._({id:"Qpg4KV"})}}function Tt(s){return{...s,icon:n.jsx(he,{color:"red"}),name:t._({id:"cnGeoo"}),tooltip:s.tooltip??t._({id:"ZatbPe"})}}function vt(s){return{...s,icon:n.jsx(Ke,{icon:"hold",iconProps:{color:"orange"}}),name:t._({id:"YJMNeo"}),tooltip:s.tooltip??t._({id:"YJMNeo"})}}function At(s){return{...s,icon:n.jsx(Ke,{icon:"cancel",iconProps:{color:"red"}}),name:t._({id:"dEgA5A"}),tooltip:s.tooltip??t._({id:"dEgA5A"})}}function It(s){return{...s,icon:n.jsx(ze,{color:"green"}),name:t._({id:"euc6Ns"}),tooltip:s.tooltip??t._({id:"QXHPgY"})}}function Wn({items:s,hidden:e,enableLabels:i,enableReports:c,modelType:o}){const u=Ge(),p=_e(),f=r.useMemo(()=>s.length>0,[s]),_=r.useMemo(()=>u.getSetting("LABEL_DEFAULT_PRINTER"),[u]),[l,h]=r.useState(null),k=r.useMemo(()=>i&&p.isSet("LABEL_ENABLE"),[i,p]),I=r.useMemo(()=>c&&p.isSet("REPORT_ENABLE"),[c,p]),[x,y]=r.useState(void 0),[w,A]=r.useState(void 0);pe({title:t._({id:"5cY8gX"}),id:x}),pe({title:t._({id:"T6GYw9"}),id:w});const[R,B]=r.useState([]),z=J({enabled:k,queryKey:["printingFields",o,l],gcTime:500,queryFn:()=>Sn.options(L(O.label_print),{params:{plugin:l||void 0}}).then(j=>je(j,"POST")||{})}),H=r.useMemo(()=>{const j=z.data||{};return j.template={...j.template,autoFill:!0,filters:{enabled:!0,model_type:o,items:R.join(",")}},j.items={...j.items,value:R,hidden:!0},j.plugin={...j.plugin,default:_,value:l,filters:{active:!0,mixin:"labels"},onValueChange:($,E)=>{E!=null&&E.key&&(E==null?void 0:E.key)!=l&&h(E.key)}},j},[_,l,z.data,R]),F=fe({url:L(O.label_print),title:t._({id:"kjqRDg"}),modalId:"print-labels",fields:H,timeout:5e3,onOpen:()=>{B(s)},onClose:()=>{h("")},submitText:t._({id:"BZz12Q"}),successMessage:null,onFormSuccess:j=>{h(""),y(j.pk)}}),b=r.useMemo(()=>({template:{autoFill:!0,filters:{enabled:!0,model_type:o,items:R.join(",")}},items:{hidden:!0,value:R}}),[R,o]),m=fe({url:L(O.report_print),title:t._({id:"qsurSb"}),modalId:"print-reports",timeout:5e3,fields:b,onOpen:()=>{B(s)},submitText:t._({id:"BZz12Q"}),successMessage:null,onFormSuccess:j=>{A(j.pk)}});return!o||!k&&!I?null:!e&&n.jsxs(n.Fragment,{children:[m.modal,F.modal,n.jsx(ye,{tooltip:t._({id:"/oz6DG"}),icon:n.jsx(hn,{}),disabled:!f,actions:[{name:t._({id:"Y93N6T"}),icon:n.jsx(fn,{}),onClick:()=>F.open(),hidden:!k},{name:t._({id:"ClULGR"}),icon:n.jsx(pn,{}),onClick:()=>m.open(),hidden:!I}]})]})}function Rt(s){return{...s,color:void 0,icon:n.jsx(Pe,{}),onClick:e=>{const i=ce(s.modelType,s.modelId);de(i,s.navigate,e)}}}function Et(s){return{...s,title:t._({id:"euc6Ns"}),color:"green",icon:n.jsx(ze,{})}}function Mt(s){return{...s,title:t._({id:"ePK91l"}),color:"blue",icon:n.jsx(Be,{})}}function Dt(s){return{...s,title:t._({id:"cnGeoo"}),color:"red",icon:n.jsx(he,{})}}function St(s){return{...s,title:t._({id:"dEgA5A"}),color:"red",icon:n.jsx(xn,{})}}function Zn({title:s,actions:e,disabled:i=!1,index:c}){function o(l){ne(l),p(!u)}const[u,p]=r.useState(!1),f=r.useMemo(()=>e.filter(l=>!l.hidden),[e]);function _(l){return n.jsx(P,{withinPortal:!0,label:l.tooltip??l.title,position:"left",children:n.jsx(v.Item,{color:l.color,leftSection:l.icon,onClick:h=>{var k;ne(h),(k=l.onClick)==null||k.call(l,h),p(!1)},disabled:l.disabled||!1,children:l.title})},l.title)}return f.length>0&&n.jsxs(v,{withinPortal:!0,disabled:i,position:"bottom-end",opened:u,onChange:p,children:[n.jsx(v.Target,{children:n.jsx(P,{withinPortal:!0,label:s||t._({id:"7L01XJ"}),children:n.jsx(U,{"aria-label":`row-action-menu-${c??""}`,onClick:o,disabled:i,variant:"subtle",color:"gray",children:n.jsx(gn,{})},`row-action-menu-${c??""}`)})}),n.jsx(v.Dropdown,{children:f.map(l=>n.jsx(_,{...l},l.title))})]})}function et(s){const[e,i]=_n({key:`inventree-filterset-${s}`,defaultValue:[],sync:!1,getInitialValueInEffect:!1}),c=r.useCallback(()=>{i([])},[]);return{filterKey:s,activeFilters:e,setActiveFilters:i,clearActiveFilters:c}}function Lt(s,e="pk"){function i(){return`${s.replaceAll("-","")}-${Cn()}`}const[c,o]=Mn(),u=r.useCallback(()=>{o({})},[]),[p,f]=r.useState(i()),_=r.useCallback(M=>{f(i()),M&&B()},[i]),l=et(`table-${s}`),[h,k]=r.useState([]),I=r.useCallback(M=>h.includes(M),[h]),[x,y]=r.useState([]),[w,A]=r.useState([]),R=r.useMemo(()=>w.map(M=>M[e||"pk"]),[w]),B=r.useCallback(()=>{A([])},[]),z=r.useMemo(()=>w.length>0,[w]),[H,F]=r.useState(0),[b,m]=r.useState(1),[j,$]=r.useState(""),[E,W]=r.useState([]),q=r.useCallback(M=>{const S=[...E],G=S.findIndex(se=>se[e||"pk"]===M.pk);G>=0?S[G]={...S[G],...M}:S.push(M),W(S)},[E]),[te,X]=r.useState(!1);return{tableKey:p,refreshTable:_,isLoading:te,setIsLoading:X,filterSet:l,queryFilters:c,setQueryFilters:o,clearQueryFilters:u,expandedRecords:h,setExpandedRecords:k,isRowExpanded:I,selectedRecords:w,selectedIds:R,setSelectedRecords:A,clearSelectedRecords:B,hasSelectedRecords:z,searchTerm:j,setSearchTerm:$,recordCount:H,setRecordCount:F,hiddenColumns:x,setHiddenColumns:y,page:b,setPage:m,records:E,setRecords:W,updateRecord:q,idAccessor:e}}function nt({icon:s,actions:e,tooltip:i="",label:c=""}){return n.jsxs(v,{shadow:"xs",children:[n.jsx(v.Target,{children:n.jsx(U,{variant:"default",children:n.jsx(P,{label:i,children:s})})}),n.jsxs(v.Dropdown,{children:[c&&n.jsx(v.Label,{children:c}),e.map((o,u)=>n.jsx(v.Item,{children:o},`${u}-${o}`))]})]})}function tt({disabled:s,debounce:e,placeholder:i,searchCallback:c}){const[o,u]=r.useState(""),[p]=jn(o,e??500);return r.useEffect(()=>{c(p)},[p]),n.jsx(He,{value:o,disabled:s,"aria-label":"table-search-input",leftSection:n.jsx(yn,{}),placeholder:i??t._({id:"A1taO8"}),onChange:f=>u(f.target.value),rightSection:o.length>0?n.jsx(qe,{size:"xs",onClick:()=>{u(""),c("")}}):null})}function st({url:s,enabled:e,filters:i,searchTerm:c}){const o=xe(),[u,p]=r.useState("inventree-exporter"),[f,_]=r.useState(void 0);pe({title:t._({id:"gAwkCm"}),id:f});const l=r.useMemo(()=>{const x={export:!0};u&&(x.export_plugin=u);for(const[y,w]of Object.entries(i??{}))w!=null&&(x[y]=w);return c&&(x.search=c),x},[u,i,c]),h=J({enabled:!!s&&e,queryKey:["export-fields",u,s,l],gcTime:500,queryFn:()=>o.options(s,{params:l}).then(x=>je(x,"GET")||{})}),k=r.useMemo(()=>{const x=h.data||{},y={export_format:{},export_plugin:{},...x};return y.export_format={...y.export_format,required:!0},y.export_plugin={...y.export_plugin,required:!0,onValueChange:w=>{w&&p(w)}},y},[h]);return fe({url:s,queryParams:new URLSearchParams(l),title:t._({id:"CEVW38"}),method:"GET",fields:k,submitText:t._({id:"GS+Mus"}),successMessage:null,timeout:30*1e3,onFormSuccess:x=>{_(x.pk),p("inventree-exporter")}})}function it({columns:s,onToggleColumn:e}){return n.jsxs(v,{shadow:"xs",closeOnItemClick:!1,children:[n.jsx(v.Target,{children:n.jsx(U,{variant:"transparent","aria-label":"table-select-columns",children:n.jsx(P,{label:t._({id:"kCTFU8"}),position:"top-end",children:n.jsx(bn,{})})})}),n.jsxs(v.Dropdown,{style:{maxHeight:"400px",overflowY:"auto"},children:[n.jsx(v.Label,{children:t._({id:"kCTFU8"})}),n.jsx(ge,{}),s.filter(i=>i.switchable??!0).map(i=>n.jsx(v.Item,{children:n.jsx(Fn,{checked:!i.hidden,label:i.title||i.accessor,onChange:()=>e(i.accessor),radius:"sm"})},i.accessor))]})]})}function rt(s){return s.choices?s.choices:s.choiceFunction?s.choiceFunction():[{value:"true",label:t._({id:"l75CjT"})},{value:"false",label:t._({id:"1UzENP"})}]}function ot(s){return()=>{const e=Ln.getState().status;if(!e)return[];const i=e[s];return i?Object.keys(i.values).map(c=>{var u;const o=i.values[c];return{value:o.key.toString(),label:((u=o.label)==null?void 0:u.toString())??o.key.toString()}}):[]}}function Ot(){return{name:"has_batch",label:t._({id:"qPCbMt"}),description:t._({id:"rc/Y1E"})}}function Bt(){return{name:"batch",label:t._({id:"Vea6Aj"}),description:t._({id:"Y/SfF6"}),type:"text"}}function zt(){return{name:"in_stock",label:t._({id:"zn38D/"}),description:t._({id:"oXdFGe"})}}function Pt(){return{name:"serialized",label:t._({id:"SkCY/+"}),description:t._({id:"S5yS1f"})}}function Ht(){return{name:"serial",label:t._({id:"ypfsn/"}),description:t._({id:"hFRTeN"}),type:"text"}}function qt(){return{name:"serial_lte",label:t._({id:"sQUbHe"}),description:t._({id:"yLzTzA"}),type:"text"}}function Ut(){return{name:"serial_gte",label:t._({id:"TiS4AP"}),description:t._({id:"Gnj5CL"}),type:"text"}}function Vt(){return{name:"assigned_to_me",type:"boolean",label:t._({id:"iU3XRS"}),description:t._({id:"BnF3ID"})}}function Nt(){return{name:"outstanding",label:t._({id:"aimnwe"}),description:t._({id:"5Dr8AX"})}}function Gt(){return{name:"overdue",label:t._({id:"ddrz1m"}),description:t._({id:"eoAfY+"})}}function Kt(){return{name:"min_date",label:t._({id:"vhCfRp"}),description:t._({id:"g6o1nx"}),type:"date"}}function Qt(){return{name:"max_date",label:t._({id:"dogwLN"}),description:t._({id:"/Is0Q9"}),type:"date"}}function Yt(){return{name:"created_before",label:t._({id:"XIK9k0"}),description:t._({id:"BVOUXI"}),type:"date"}}function $t(){return{name:"created_after",label:t._({id:"pQfuT0"}),description:t._({id:"5D7LoD"}),type:"date"}}function Xt(){return{name:"start_date_before",label:t._({id:"MpyljM"}),description:t._({id:"YgY+H6"}),type:"date"}}function Jt(){return{name:"start_date_after",label:t._({id:"8IA8ke"}),description:t._({id:"5gLRm5"}),type:"date"}}function Wt(){return{name:"target_date_before",label:t._({id:"SsUIID"}),description:t._({id:"Ey6gw7"}),type:"date"}}function Zt(){return{name:"target_date_after",label:t._({id:"a8vo2j"}),description:t._({id:"wvwgPk"}),type:"date"}}function es(){return{name:"completed_before",label:t._({id:"7Ul+eL"}),description:t._({id:"qR6hn8"}),type:"date"}}function ns(){return{name:"completed_after",label:t._({id:"cFFv89"}),description:t._({id:"liohcD"}),type:"date"}}function ts(){const e=_e.getState().isSet("PROJECT_CODES_ENABLED",!0);return{name:"has_project_code",type:"boolean",label:t._({id:"e7gdBS"}),description:t._({id:"gW+vYR"}),active:e}}function ss(){return{name:"include_variants",type:"boolean",label:t._({id:"/g9i/Z"}),description:t._({id:"yDiGmv"})}}function is({model:s}){return{name:"status",label:t._({id:"uAQUqI"}),description:t._({id:"OIH7WF"}),choiceFunction:ot(s)}}function rs(){const e=_e.getState().isSet("PROJECT_CODES_ENABLED",!0);return{name:"project_code",label:t._({id:"Sdfr6G"}),description:t._({id:"8sHFLc"}),active:e,type:"api",apiUrl:L(O.project_code_list),model:N.projectcode,modelRenderer:i=>i.code}}function lt({name:s,label:e,description:i}){return{name:s,label:e,description:i,type:"api",apiUrl:L(O.owner_list),model:N.owner,modelRenderer:c=>c.name}}function os(){return lt({name:"assigned_to",label:t._({id:"XQACoK"}),description:t._({id:"OVVPn5"})})}function Qe({name:s,label:e,description:i}){return{name:s??"user",label:e??t._({id:"7PzzBU"}),description:i??t._({id:"FVjW63"}),type:"api",apiUrl:L(O.user_list),model:N.user,modelRenderer:c=>c.username}}function ls(){return{name:"manufacturer",label:t._({id:"+m9/3S"}),description:t._({id:"ZbKIR3"}),type:"api",apiUrl:L(O.company_list),model:N.company,modelRenderer:s=>s.name,apiFilter:{is_manufacturer:!0}}}function as(){return{name:"supplier",label:t._({id:"PYTEl0"}),description:t._({id:"L+0p0h"}),type:"api",apiUrl:L(O.company_list),model:N.company,modelRenderer:s=>s.name,apiFilter:{is_supplier:!0}}}function cs(){return Qe({name:"created_by",label:t._({id:"egTba/"}),description:t._({id:"cX/tzW"})})}function ds(){return Qe({name:"issued_by",label:t._({id:"kmUN8p"}),description:t._({id:"QFznVK"})})}function us(){return{name:"category",label:t._({id:"QXANxH"}),description:t._({id:"/zwgG7"}),apiUrl:L(O.category_list),model:N.partcategory,modelRenderer:s=>s.name}}function ms(){return{name:"location",label:t._({id:"wJijgU"}),description:t._({id:"Bp02Dg"}),apiUrl:L(O.stock_location_list),model:N.stocklocation,modelRenderer:s=>s.name}}function at({flt:s,filterSet:e}){const i=r.useCallback(()=>{const c=e.activeFilters.filter(o=>o.name!==s.name);e.setActiveFilters(c)},[s]);return n.jsx(Ve,{p:"sm",shadow:"sm",radius:"xs",children:n.jsxs(Q,{justify:"space-between",wrap:"nowrap",children:[n.jsxs(Y,{gap:"xs",children:[n.jsx(V,{size:"sm",children:s.label}),n.jsx(V,{size:"xs",children:s.description})]}),n.jsxs(Q,{justify:"right",children:[n.jsx(wn,{children:s.displayValue??s.value}),n.jsx(P,{label:t._({id:"rn2/2V"}),withinPortal:!0,children:n.jsx(qe,{size:"md",color:"red",onClick:i})})]})]},s.name)})}function ct({filterName:s,filterProps:e,valueOptions:i,onValueChange:c}){const o=r.useCallback(f=>{if(f){const _=f.toString();c(Vn(_).format("YYYY-MM-DD"))}else c("")},[c]),[u,p]=r.useState("");switch(e.type){case"api":return n.jsx(Gn,{fieldName:`filter-${s}`,fieldDefinition:{field_type:"related field",api_url:e.apiUrl,filters:e.apiFilter,placeholder:t._({id:"Fo55lj"}),model:e.model,label:t._({id:"Fo55lj"}),onValueChange:(f,_)=>{var l;c(f,(l=e.modelRenderer)==null?void 0:l.call(e,_))}}});case"text":return n.jsx(He,{label:t._({id:"wMHvYH"}),value:u,placeholder:t._({id:"Q//Mlp"}),rightSection:n.jsx(U,{"aria-label":"apply-text-filter",variant:"transparent",onClick:()=>c(u),children:n.jsx(Tn,{})}),onChange:f=>p(f.currentTarget.value),onKeyDown:f=>{f.key==="Enter"&&c(u)}});case"date":return n.jsx(Nn,{label:t._({id:"wMHvYH"}),placeholder:t._({id:"A63fc7"}),onChange:o});case"choice":case"boolean":default:return n.jsx(Ne,{data:i,searchable:e.type=="choice",label:t._({id:"wMHvYH"}),withScrollArea:!1,placeholder:t._({id:"Fo55lj"}),onChange:f=>c(f),maxDropdownHeight:800})}}function dt({filterSet:s,availableFilters:e}){const i=r.useMemo(()=>{var h,k,I;let l=[];return s.activeFilters&&s.activeFilters.length>0&&(l=((h=s.activeFilters)==null?void 0:h.map(x=>x.name))??[]),((I=(k=e==null?void 0:e.filter(x=>!l.includes(x.name)))==null?void 0:k.sort((x,y)=>x.label.localeCompare(y.label)))==null?void 0:I.map(x=>({value:x.name,label:x.label,description:x.description})))??[]},[s.activeFilters,e]),[c,o]=r.useState(null),u=r.useMemo(()=>{const l=e==null?void 0:e.find(h=>h.name===c);return l?rt(l):[]},[c]),p=l=>l.type?l.type:l.apiUrl&&l.model?"api":l.choices||l.choiceFunction?"choice":"boolean",f=r.useMemo(()=>{const l=e==null?void 0:e.find(h=>h.name===c);return l&&(l.type=p(l)),l},[e,c]),_=r.useCallback((l,h)=>{var y,w;const k=e.find(A=>A.name===c);if(!k)return;const I=((y=s.activeFilters)==null?void 0:y.filter(A=>A.name!==c))??[],x={...k,value:l,displayValue:h??((w=u.find(A=>A.value===l))==null?void 0:w.label)};s.setActiveFilters([...I,x]),o(null)},[c]);return n.jsxs(Y,{gap:"xs",children:[n.jsx(Ne,{data:i,searchable:!0,placeholder:t._({id:"hpMOSe"}),label:t._({id:"o7J4JM"}),onChange:l=>o(l),maxDropdownHeight:400}),c&&f&&n.jsx(ct,{filterName:c,filterProps:f,valueOptions:u,onValueChange:_})]})}function ut({title:s,availableFilters:e,filterSet:i,opened:c,onClose:o}){var _;const[u,p]=r.useState(!1);r.useEffect(()=>{p(!1)},[i.activeFilters]);const f=r.useMemo(()=>((i==null?void 0:i.activeFilters)??[]).length>0,[i.activeFilters]);return n.jsxs(kn,{size:"sm",position:"right",withCloseButton:!0,opened:c,onClose:o,closeButtonProps:{"aria-label":"filter-drawer-close"},title:n.jsx(Ce,{size:"lg",children:s??t._({id:"l34cnu"})}),children:[n.jsx(ge,{}),n.jsx(Ue,{h:"sm"}),n.jsxs(Y,{gap:"xs",children:[f&&((_=i.activeFilters)==null?void 0:_.map(l=>n.jsx(at,{flt:l,filterSet:i},l.name))),u&&n.jsx(Y,{gap:"xs",children:n.jsx(dt,{filterSet:i,availableFilters:e})}),u&&n.jsx(ee,{onClick:()=>p(!1),color:"orange",variant:"subtle",children:n.jsx(V,{children:t._({id:"dEgA5A"})})}),!u&&i.activeFilters.length<e.length&&n.jsx(ee,{onClick:()=>p(!0),color:"green",variant:"subtle",children:n.jsx(V,{children:t._({id:"PzFzS+"})})}),!u&&i.activeFilters.length>0&&n.jsx(ee,{onClick:i.clearActiveFilters,color:"red",variant:"subtle",children:n.jsx(V,{children:t._({id:"J8ECgX"})})})]})]})}function mt({tableUrl:s,tableState:e,tableProps:i,hasSwitchableColumns:c,columns:o,filters:u,toggleColumn:p}){var w,A,R,B,z,H,F;const[f,_]=r.useState(!1),l=r.useMemo(()=>{const b={};for(const[m,j]of Object.entries(i.params??{}))j!=null&&(b[m]=j);if(e.filterSet.activeFilters&&e.filterSet.activeFilters.forEach(m=>{b[m.name]=m.value}),e.queryFilters)for(const[m,j]of e.queryFilters)j!=null&&(b[m]=j);return b},[i.params,e.filterSet,e.queryFilters]),h=st({url:s??"",enabled:!!s&&(i==null?void 0:i.enableDownload)!=!1,filters:l,searchTerm:e.searchTerm}),k=Kn({url:s??"",title:t._({id:"NEGzXb"}),preFormContent:n.jsx(Re,{color:"red",title:t._({id:"3kYcuM"}),children:t._({id:"U99rVM"})}),initialData:{items:e.selectedIds},fields:{items:{hidden:!0}},successMessage:t._({id:"B7s1hd"}),onFormError:b=>{Le({id:"bulk-delete-error",title:t._({id:"SlfejT"}),message:t._({id:"NO2Qmx"}),color:"red",icon:n.jsx(Oe,{}),autoClose:5e3})},onFormSuccess:()=>{e.clearSelectedRecords(),e.refreshTable(),i.afterBulkDelete&&i.afterBulkDelete()}}),I=r.useMemo(()=>e.queryFilters.has("search"),[e.queryFilters]),x=r.useMemo(()=>{var b;return(((b=e==null?void 0:e.queryFilters)==null?void 0:b.size)??0)>0},[e.queryFilters]),y=r.useMemo(()=>{var b;return((b=e.selectedRecords)==null?void 0:b.map(m=>ue(m,i.printingAccessor??"pk")))??[]},[i.printingAccessor,e.selectedRecords]);return n.jsxs(n.Fragment,{children:[h.modal,k.modal,i.enableFilters&&(u.length??0)>0&&n.jsx(me,{label:`InvenTreeTableFilterDrawer-${e.tableKey}`,children:n.jsx(ut,{availableFilters:u,filterSet:e.filterSet,opened:f,onClose:()=>_(!1)})}),(x||I)&&n.jsx(Re,{color:"yellow",withCloseButton:!0,title:t._({id:"VUTcDq"}),onClose:()=>e.clearQueryFilters()}),n.jsxs(Q,{justify:"apart",grow:!0,wrap:"nowrap",children:[n.jsxs(Q,{justify:"left",gap:5,wrap:"nowrap",children:[n.jsx(Wn,{items:y,modelType:i.modelType,enableLabels:i.enableLabels,enableReports:i.enableReports}),(((w=i.barcodeActions)==null?void 0:w.length)??0)>0&&n.jsx(nt,{icon:n.jsx(vn,{}),label:t._({id:"heU0Hk"}),tooltip:t._({id:"heU0Hk"}),actions:i.barcodeActions??[]},"barcode-actions"),i.enableBulkDelete&&n.jsx(Yn,{disabled:!e.hasSelectedRecords,icon:n.jsx(he,{}),color:"red",tooltip:t._({id:"QZQ+5V"}),onClick:()=>{k.open()}}),(A=i.tableActions)==null?void 0:A.map((b,m)=>n.jsx(n.Fragment,{children:b},m))]},"custom-actions"),n.jsx(Ue,{}),n.jsxs(Q,{justify:"right",gap:5,wrap:"nowrap",children:[i.enableSearch&&n.jsx(tt,{disabled:I,searchCallback:b=>e.setSearchTerm(b)}),i.enableRefresh&&n.jsx(U,{variant:"transparent","aria-label":"table-refresh",children:n.jsx(P,{label:t._({id:"8RYNR1"}),position:"top-end",children:n.jsx(An,{onClick:()=>{e.refreshTable(),e.clearSelectedRecords()}})})}),c&&n.jsx(it,{columns:o,onToggleColumn:p}),i.enableFilters&&u.length>0&&n.jsx(ae,{size:"xs",label:((R=e.filterSet.activeFilters)==null?void 0:R.length)??0,disabled:((B=e.filterSet.activeFilters)==null?void 0:B.length)==0,children:n.jsx(U,{disabled:x,variant:"transparent","aria-label":"table-select-filters",children:n.jsxs(oe,{position:"bottom-end",withinPortal:!0,disabled:!((z=e.filterSet.activeFilters)!=null&&z.length),children:[n.jsx(oe.Target,{children:n.jsx(P,{label:t._({id:"l34cnu"}),position:"top-end",disabled:!!((H=e.filterSet.activeFilters)!=null&&H.length),children:n.jsx(In,{onClick:()=>_(!f)})})}),n.jsx(oe.Dropdown,{children:n.jsx(Ve,{p:"sm",withBorder:!0,children:n.jsxs(Y,{gap:"xs",children:[n.jsx(Ce,{size:"md",children:t._({id:"GhOy5V"})}),n.jsx(ge,{}),(F=e.filterSet.activeFilters)==null?void 0:F.map(b=>n.jsxs(Q,{justify:"space-between",gap:"xl",wrap:"nowrap",children:[n.jsx(V,{size:"sm",children:b.label}),n.jsx(V,{size:"xs",children:b.displayValue})]},b.name))]})})})]})})}),s&&i.enableDownload&&n.jsx(U,{variant:"transparent","aria-label":"table-export-data",children:n.jsx(P,{label:t._({id:"ECXmiK"}),position:"top-end",children:n.jsx(Rn,{onClick:h.open})})})]})]})]})}const Se="--actions--",ft=[10,15,20,25,50,100,500],pt={params:{},noRecordsText:t._({id:"EqGTpW"}),enableDownload:!1,enableLabels:!1,enableReports:!1,enableFilters:!0,enablePagination:!0,enableRefresh:!0,enableSearch:!0,enableSelection:!1,defaultSortColumn:"",barcodeActions:[],printingAccessor:"pk",tableFilters:[],tableActions:[]};function fs({url:s,tableState:e,tableData:i,columns:c,props:o}){const{userTheme:u}=On(),{pageSize:p,setPageSize:f,getHiddenColumns:_,setHiddenColumns:l,getTableColumnNames:h,setTableColumnNames:k,getTableSorting:I,setTableSorting:x}=zn(),[y,w]=r.useState({}),A=xe(),R=Pn(),{showContextMenu:B}=Hn(),z=Ge(),H=r.useMemo(()=>z.isSet("STICKY_TABLE_HEADER"),[z]),F=r.useMemo(()=>{const a=`table-${e.tableKey}`,d=a.indexOf("-mantine");return d>=0?a.substring(0,d):a},[e.tableKey]),b=r.useMemo(()=>{var a,d;return((d=(a=o.tableFilters)==null?void 0:a.filter(g=>g.active!=!1))==null?void 0:d.map(g=>({...g,label:g.label??y[g.name]??`${g.name}`})))??[]},[o.tableFilters,y]),m=r.useMemo(()=>({...pt,...o}),[o]),j=J({enabled:!!s&&!i,queryKey:["options",s,F,m.params,o.enableColumnCaching],retry:5,retryDelay:a=>(1+a)*250,throwOnError:a=>(Me({error:a,title:t._({id:"0uyCkG"})}),!0),refetchOnMount:!0,gcTime:5e3,queryFn:async()=>!s||o.enableColumnCaching==!1||y&&Object.keys(y).length>0?null:A.options(s,{params:m.params}).then(a=>{if(a.status==200){const d={},g=je(a,"GET",!0)||{};Qn(g,(C,T)=>{T.label&&(d[C]=T.label)}),w(d),k(F)(d)}return null})});r.useEffect(()=>{if(o.enableColumnCaching==!1)return;const a=h(F);if(a!=null){w(a);return}},[]);const $=r.useMemo(()=>m.enableSelection||m.enableBulkDelete||!1,[m]),E=r.useMemo(()=>o.enableColumnSwitching==!1?!1:c.some(a=>a.hidden==!0?!1:a.switchable!=!1),[c,o.enableColumnSwitching]),W=r.useCallback(a=>{e.setSelectedRecords(a)},[e.setSelectedRecords]),q=r.useMemo(()=>{let a=c.filter(d=>(d==null?void 0:d.hidden)!=!0);return a=a.map(d=>{var C;const g=d.switchable==!1?!1:((C=e.hiddenColumns)==null?void 0:C.includes(d.accessor))??!1;return{...d,hidden:g,resizable:d.resizable??!0,title:d.title??y[d.accessor]??`${d.accessor}`,cellsStyle:(T,D)=>({minWidth:d.minWidth??100}),titleStyle:(T,D)=>({minWidth:d.minWidth??100})}}),m.rowActions&&a.push({accessor:Se,title:"   ",hidden:!1,resizable:!1,switchable:!1,width:50,render:(d,g)=>{var C;return n.jsx(Zn,{actions:((C=m.rowActions)==null?void 0:C.call(m,d))??[],disabled:e.selectedRecords.length>0,index:g})}}),a},[c,y,m.rowActions,e.hiddenColumns,e.selectedRecords]),te=r.useCallback(a=>{const d=[...q],g=d.findIndex(T=>T.accessor==a);g>=0&&g<d.length&&(d[g].hidden=!d[g].hidden);const C=d.filter(T=>T.hidden).map(T=>T.accessor);e.setHiddenColumns(C),l(F)(C)},[F,q]),X=qn({key:F,columns:q,getInitialValueInEffect:!1}),M=r.useMemo(()=>q.map(a=>a.accessor),[q]);r.useEffect(()=>{JSON.stringify(X.columnsOrder)!=JSON.stringify(M)&&X.setColumnsOrder(M)},[F,M]),r.useEffect(()=>{e.setPage(1),e.clearSelectedRecords()},[e.searchTerm,e.filterSet.activeFilters,e.queryFilters]),r.useEffect(()=>{(e.page>1&&p*(e.page-1)>e.recordCount||e.page<1)&&e.setPage(1),p<10&&f(25)},[e.records,e.page,p]);const[S,G]=r.useState({columnAccessor:m.defaultSortColumn??"",direction:"asc"}),se=r.useCallback((a=!1)=>{const d={...m.params};if(e.queryFilters&&e.queryFilters.size>0)for(const[C,T]of e.queryFilters)d[C]=T;else e.filterSet.activeFilters&&e.filterSet.activeFilters.forEach(C=>{d[C.name]=C.value});e.searchTerm&&(d.search=e.searchTerm),m.enablePagination&&a&&(d.limit=p,d.offset=(e.page-1)*p);const g=Fe();return g&&(S.direction=="asc"?d.ordering=g:d.ordering=`-${g}`),d},[S,m.params,m.enablePagination,e.filterSet.activeFilters,e.queryFilters,e.searchTerm,Fe]),[be,Ye]=r.useState(!1);r.useEffect(()=>{const a=I(F);a&&a.columnAccessor&&a.direction&&G(a);const d=_(F);if(d==null){const g=c.filter(C=>C.switchable!=!1&&C.defaultVisible==!1).map(C=>C.accessor);l(F)(g),e.setHiddenColumns(g)}else e.setHiddenColumns(d);Ye(!0)},[F]);function Fe(){const a=S.columnAccessor;if(a=="")return"";const d=q.find(g=>g.accessor==a);return(d==null?void 0:d.ordering)||a}const[$e,Xe]=r.useState(m.noRecordsText??t._({id:"EqGTpW"})),Je=r.useCallback(a=>{e.setPage(1),G(a),x(F)(a)},[F]),We=async()=>{const a=se(!0);return s?be?A.get(s,{params:a,timeout:10*1e3}).then(d=>{var C,T;let g=((C=d.data)==null?void 0:C.results)??d.data??[];return o.dataFormatter&&(g=o.dataFormatter(g)),Array.isArray(g)||(Xe(t._({id:"3o3AAs"})),g=[]),e.setRecordCount(((T=d.data)==null?void 0:T.count)??g.length),g}):[]:[]},{data:ke,isFetching:ie,isLoading:we,refetch:Ze}=J({queryKey:["tabledata",s,e.page,o.params,be,S.columnAccessor,S.direction,e.tableKey,e.filterSet.activeFilters,e.searchTerm],retry:5,retryDelay:a=>(1+a)*250,throwOnError:a=>(Me({error:a,title:t._({id:"UJqwtM"})}),!0),enabled:!!s&&!i,queryFn:We});r.useEffect(()=>{Ze()},[e.queryFilters]),r.useEffect(()=>{const a=ie||we||j.isFetching||j.isLoading;a!=e.isLoading&&e.setIsLoading(a)},[ie,we,j.isFetching,j.isLoading,e.isLoading]);const Te=r.useMemo(()=>m.enablePagination!=!1?p:e.recordCount,[m.enablePagination,p,e.recordCount]);r.useEffect(()=>{e.setRecords(i??ke??[])},[i,ke]);const en=r.useCallback(({event:a,record:d,index:g,column:C,columnIndex:T})=>{if(C.accessor!=Se){if(o.onCellClick)o.onCellClick({event:a,record:d,index:g,column:C,columnIndex:T});else if(o.onRowClick)o.onRowClick(d,g,a);else if(m.modelType){const D=m.modelField??"pk",K=ue(d,D);if(K){ne(a);const re=ce(m.modelType,K);de(re,R,a)}}}},[o.onRowClick,o.onCellClick]),nn=r.useMemo(()=>!!o.onCellContextMenu||!!o.rowActions||!!o.modelType,[o.onCellContextMenu,o.rowActions,o.modelType]),tn=({record:a,column:d,event:g})=>{if((d==null?void 0:d.noContext)===!0)return;if(o.onCellContextMenu)return o.onCellContextMenu(a,g);const C=()=>{};let T=[];if(o.rowActions&&(T=o.rowActions(a).map(D=>({key:D.title??"",title:D.title??"",color:D.color,icon:D.icon,onClick:D.onClick??C,hidden:D.hidden,disabled:D.disabled}))),o.modelType){const D=o.modelField??"pk",K=ue(a,D),re=ce(o.modelType,K);T.push({key:"detail",title:t._({id:"2Eoi/a"}),icon:n.jsx(Pe,{}),onClick:Ae=>{ne(Ae),de(re,R,Ae)}})}return B(T)(g)},ve=r.useCallback(a=>{f(a),e.setPage(1),e.refreshTable()},[]),sn=r.useMemo(()=>{if(o.rowExpansion)return{...o.rowExpansion,expanded:{recordIds:e.expandedRecords,onRecordIdsChange:a=>{e.setExpandedRecords(a)}}}},[e.expandedRecords,e.setExpandedRecords,o.rowExpansion]),rn=r.useMemo(()=>{let a={};return m.enablePagination&&(a={...a,totalRecords:e.recordCount,recordsPerPage:Te,page:Math.max(1,e.page),onPageChange:e.setPage,recordsPerPageOptions:ft,onRecordsPerPageChange:ve}),a},[Te,m.enablePagination,e.recordCount,e.page,e.setPage,ve]),on=r.useMemo(()=>!!(m.onCellClick||m.onRowClick||m.modelType),[m.onCellClick,m.onRowClick,m.modelType]);return n.jsx(n.Fragment,{children:n.jsxs(Y,{gap:"xs",children:[!m.noHeader&&n.jsx(me,{label:`InvenTreeTableHeader-${F}`,children:n.jsx(mt,{tableUrl:s,tableState:e,tableProps:m,hasSwitchableColumns:E,columns:q,filters:b,toggleColumn:te})}),n.jsx(me,{label:`InvenTreeTable-${F}`,children:n.jsx(En,{pos:"relative",children:n.jsx(Un,{style:{stickyHeader:H?"top":void 0},height:H?"80vh":void 0,withTableBorder:!m.noHeader,withColumnBorders:!0,striped:!0,highlightOnHover:!0,loaderType:u.loader,pinLastColumn:m.rowActions!=null,idAccessor:e.idAccessor??"pk",minHeight:m.minHeight??300,sortStatus:S,onSortStatusChange:Je,selectedRecords:$?e.selectedRecords:void 0,onSelectedRecordsChange:$?W:void 0,rowExpansion:sn,fetching:ie,noRecordsText:$e,records:e.records,storeColumnsKey:F,columns:X.effectiveColumns,onCellClick:on?en:void 0,noHeader:m.noHeader??!1,defaultColumnProps:{textAlign:"left"},onCellContextMenu:nn?tn:void 0,...rn})})})]})})}export{St as $,Vt as A,Bt as B,Yt as C,Tt as D,wt as E,It as F,Et as G,ts as H,fs as I,us as J,Rt as K,ds as L,Kt as M,ms as N,Ft as O,Wn as P,Zn as Q,Mt as R,Xt as S,Wt as T,Qe as U,et as V,st as W,ut as X,tt as Y,vt as Z,At as _,Dt as a,is as b,Nt as c,Gt as d,Qt as e,$t as f,Zt as g,Jt as h,es as i,ns as j,rs as k,os as l,cs as m,ss as n,ot as o,zt as p,as as q,ls as r,Ot as s,Pt as t,Lt as u,Ht as v,qt as w,Ut as x,ye as y,kt as z};
//# sourceMappingURL=InvenTreeTable-BLgfUICM.js.map
