import{r as n,i as t,j as s,B as H,eN as Q,b2 as le,cy as ce,dA as X,by as de,bX as C,bx as ue,b9 as pe,S as me}from"./vendor-COjCG5sX.js";import{b as te,m as o,A as c,U as _,e as T,f as _e}from"./index-ClP83spC.js";import{A as he}from"./AdminButton-DmZZOxW8.js";import{P as Z}from"./PrimaryActionButton-SR4hKiWf.js";import{u as be,K as ye,R as fe,G as xe,a as ke,I as ge,z as Ce,P as je,O as Pe,E as Ae,F as Se,Z as De,_ as Ie}from"./InvenTreeTable-BLgfUICM.js";import{I as ve,D as O,a as Fe}from"./InstanceDetail-D0JUiPv3.js";import{D as Re,N as Le}from"./NotesPanel-2dK9X1T7.js";import{a as Te,q as Ee,S as Y}from"./ThemeContext-B85sS1BU.js";import{P as Ne}from"./PageDetail-p6Y4q-h-.js";import{A as Me}from"./AttachmentPanel-Be6kmD3E.js";import{P as qe}from"./PanelGroup-CYF3auDg.js";import{b as j,R as Oe,n as we,g as We,u as se,a as Ke,A as Ue,h as Ve}from"./UseForm-DUtLE7-5.js";import{a as ie}from"./formatters-BZ5YEOyk.js";import{a as Be,b as J,u as z}from"./PurchaseOrderForms-DPLnYzsw.js";import{u as Ge}from"./UseInstance-CwLXxgXl.js";import{u as ae}from"./UseStatusCodes-ChLgWVsN.js";import{E as He}from"./ExtraLineItemTable-CuGET5Ep.js";import{A as $}from"./ActionButton-DLsRvAT1.js";import{P as Qe}from"./index-dkDFLfDd.js";import{d as Xe,I as Ze}from"./ImporterForms-Cew_c8Y9.js";import{P as Ye,D as Je,R as ze,L as ee,o as $e,T as et,j as tt,N as st}from"./ColumnRenderers-g3zQL0h_.js";import{S as it}from"./StockItemTable-bW53PHd8.js";import"./DesktopAppView-DxQJo3T-.js";import"./QRCode-tr3h0Ayp.js";import"./browser-BL541dLs.js";import"./YesNoButton-DD4RFE30.js";import"./ModelType-CaQkIuKb.js";import"./GenericErrorPage-DS07aljU.js";import"./NotFound-LPA9XMjd.js";import"./PermissionDenied-DglG0Y8V.js";import"./PageTitle-Cvnbh7U4.js";import"./AttachmentLink-Bdm2Ykvd.js";import"./PluginSource-CHMSfDB-.js";import"./RemoteComponent-C77F08TN.js";import"./RemoveRowButton-CcCl0sVr.js";import"./UseGenerator-CdxkBrcC.js";import"./CommonForms-CICCJ9xM.js";import"./OrderPartsWizard-CHxSYjNR.js";import"./CompanyForms-CQAVE0Ar.js";import"./UseStockAdjustActions-DrD9IiH8.js";function at({order:a,orderDetailRefresh:y,orderId:d,currency:e,supplierId:h,params:b}){const l=be("purchase-order-line-item"),w=Te(),u=te(),[S,E]=n.useState(!1),[D,N]=n.useState(void 0),W=n.useMemo(()=>{var p;const i=Xe({modelType:o.purchaseorderlineitem});return i.field_overrides.value={order:d},i.field_defaults.value={purchase_price_currency:(a==null?void 0:a.order_currency)||((p=a==null?void 0:a.supplier_detail)==null?void 0:p.currency)||void 0},i.field_filters.value={part:{supplier:h,active:!0}},i},[a,d,h]),m=j({url:c.import_session_list,title:t._({id:"yWWRAr"}),fields:W,onFormSuccess:i=>{N(i.pk),E(!0)}}),[I,v]=n.useState(null),P=Be({items:I?[I]:l.selectedRecords,orderPk:d,destinationPk:a.destination,formProps:{onClose:()=>{l.clearSelectedRecords(),l.refreshTable(),setTimeout(()=>v(null),500)}}}),M=n.useMemo(()=>[Ye({part:"part_detail",ordering:"part_name"}),{accessor:"part_detail.IPN",sortable:!0,ordering:"IPN"},Je({accessor:"part_detail.description"}),ze({}),{accessor:"build_order",title:t._({id:"YxwWvi"}),sortable:!0,defaultVisible:!1,render:i=>i.build_order_detail?s.jsx(Oe,{instance:i.build_order_detail,model:o.build}):"-"},{accessor:"quantity",title:t._({id:"VbWX2u"}),sortable:!0,switchable:!1,render:i=>{const p=(i==null?void 0:i.supplier_part_detail)??{},B=(i==null?void 0:i.part_detail)??(p==null?void 0:p.part_detail)??{},G=[];if((p==null?void 0:p.pack_quantity_native)!=null&&p.pack_quantity_native!=1){const ne=i.quantity*p.pack_quantity_native;G.push(s.jsxs(H,{children:[t._({id:"J9LTXQ"}),": ",p.pack_quantity]},"pack-quantity")),G.push(s.jsxs(H,{children:[t._({id:"GbI1d2"}),": ",ne," ",B==null?void 0:B.units]},"total-quantity"))}return s.jsx(we,{value:We(i.quantity),extra:G,title:t._({id:"VbWX2u"})})}},{accessor:"received",title:t._({id:"fZ5Vnu"}),sortable:!1,render:i=>s.jsx(Qe,{progressLabel:!0,value:i.received,maximum:i.quantity})},{accessor:"supplier_part_detail.packaging",sortable:!1,title:t._({id:"pD/Ew0"}),defaultVisible:!1},{accessor:"supplier_part_detail.pack_quantity",sortable:!1,title:t._({id:"J9LTXQ"})},{accessor:"sku",title:t._({id:"PeuqsI"}),switchable:!1,sortable:!0,ordering:"SKU"},ee({accessor:"supplier_part_detail.link",title:t._({id:"h3/Rpt"}),sortable:!1,defaultVisible:!1}),{accessor:"mpn",ordering:"MPN",title:t._({id:"u7qly3"}),sortable:!0,defaultVisible:!1},$e({accessor:"purchase_price",title:t._({id:"vWelsN"})}),{accessor:"total_price",title:t._({id:"KyZVKD"}),render:i=>ie(i.purchase_price,{currency:i.purchase_price_currency,multiplier:i.quantity})},et({}),tt({accessor:"destination_detail",sortable:!1,title:t._({id:"Enslfm"})}),st({}),ee({})],[d,u]),K=n.useMemo(()=>[{name:"received",label:t._({id:"fZ5Vnu"}),description:t._({id:"8Dmqxr"})}],[]),U=J({create:!0,orderId:d,supplierId:h}),[V,F]=n.useState({}),r=j({url:c.purchase_order_line_list,title:t._({id:"pwb7Yo"}),fields:U,initialData:{...V,purchase_price_currency:e},onFormSuccess:y,table:l}),[f,A]=n.useState(0),R=J({create:!1,orderId:d,supplierId:h}),g=se({url:c.purchase_order_line_list,pk:f,title:t._({id:"vgosWS"}),fields:R,onFormSuccess:y,table:l}),L=Ke({url:c.purchase_order_line_list,pk:f,title:t._({id:"tpKh8C"}),onFormSuccess:y,table:l}),x=ae({modelType:o.purchaseorder}),k=n.useMemo(()=>a.status==x.PENDING||a.status==x.PLACED||a.status==x.ON_HOLD,[a,x]),q=n.useMemo(()=>a.status==x.PLACED,[a,x]),re=n.useCallback(i=>[{hidden:((i==null?void 0:i.received)??0)>=((i==null?void 0:i.quantity)??0)||!q,title:t._({id:"ul9IpB"}),icon:s.jsx(Q,{}),color:"green",onClick:()=>{v(i),P.open()}},ye({hidden:!i.build_order,title:t._({id:"bjYQWK"}),modelType:o.build,modelId:i.build_order,navigate:w}),fe({hidden:!u.hasChangeRole(_.purchase_order),onClick:()=>{A(i.pk),g.open()}}),xe({hidden:!k||!u.hasAddRole(_.purchase_order),onClick:()=>{F({...i}),r.open()}}),ke({hidden:!u.hasDeleteRole(_.purchase_order),onClick:()=>{A(i.pk),L.open()}})],[d,u,k,q]),oe=n.useMemo(()=>[s.jsx($,{hidden:!k||!u.hasAddRole(_.purchase_order),tooltip:t._({id:"yWWRAr"}),icon:s.jsx(le,{}),onClick:()=>m.open()},"import-line-items"),s.jsx(Ue,{tooltip:t._({id:"pwb7Yo"}),onClick:()=>{F({order:d}),r.open()},hidden:!k||!(u!=null&&u.hasAddRole(_.purchase_order))},"add-line-item"),s.jsx($,{text:t._({id:"gyK1dv"}),icon:s.jsx(Q,{}),onClick:()=>P.open(),disabled:l.selectedRecords.length===0,hidden:!q||!u.hasChangeRole(_.purchase_order)},"receive-items")],[d,u,l,k,q]);return s.jsxs(s.Fragment,{children:[m.modal,P.modal,r.modal,g.modal,L.modal,s.jsx(ge,{url:T(c.purchase_order_line_list),tableState:l,columns:M,props:{enableSelection:!0,enableDownload:!0,params:{...b,order:d,part_detail:!0},rowActions:re,tableActions:oe,tableFilters:K,modelType:o.supplierpart,modelField:"part"}}),s.jsx(Ze,{sessionId:D??-1,opened:D!=null&&S,onClose:()=>{N(void 0),E(!1),l.refreshTable()}})]})}function Gt(){var F;const{id:a}=Ee(),y=te(),d=_e(),{instance:e,instanceQuery:h,refreshInstance:b}=Ge({endpoint:c.purchase_order_list,pk:a,params:{supplier_detail:!0},refetchOnMount:!0}),l=n.useMemo(()=>{var r;return e.order_currency||((r=e.supplier_detail)==null?void 0:r.currency)||d.getSetting("INVENTREE_DEFAULT_CURRENCY")},[e,d]),w=z({}),u=z({duplicateOrderId:e.pk}),S=se({url:c.purchase_order_list,pk:a,title:t._({id:"lAF9Uk"}),fields:w,onFormSuccess:()=>{b()}}),E=n.useMemo(()=>{const r={...e};return delete r.reference,r},[e]),D=j({url:c.purchase_order_list,title:t._({id:"XRoR1U"}),fields:u,initialData:E,follow:!0,modelType:o.purchaseorder}),N=n.useMemo(()=>{var g,L,x;if(h.isFetching)return s.jsx(ce,{});const r=[{type:"text",name:"reference",label:t._({id:"N2C89m"}),copy:!0},{type:"text",name:"supplier_reference",label:t._({id:"K7PVg3"}),icon:"reference",hidden:!e.supplier_reference,copy:!0},{type:"link",name:"supplier",icon:"suppliers",label:t._({id:"PYTEl0"}),model:o.company},{type:"text",name:"description",label:t._({id:"Nu4oKW"}),copy:!0},{type:"status",name:"status",label:t._({id:"uAQUqI"}),model:o.purchaseorder},{type:"status",name:"status_custom_key",label:t._({id:"4DvUAJ"}),model:o.purchaseorder,icon:"status",hidden:!e.status_custom_key||e.status_custom_key==e.status}],f=[{type:"progressbar",name:"completed",icon:"progress",label:t._({id:"qgs95u"}),total:e.line_items,progress:e.completed_lines},{type:"link",model:o.stocklocation,link:!0,name:"destination",label:t._({id:"Enslfm"}),hidden:!e.destination},{type:"text",name:"currency",label:t._({id:"0UZTSq"}),value_formatter:()=>l},{type:"text",name:"total_price",label:t._({id:"A6C0pv"}),value_formatter:()=>{var k;return ie(e==null?void 0:e.total_price,{currency:(e==null?void 0:e.order_currency)||((k=e==null?void 0:e.supplier_detail)==null?void 0:k.currency)})}}],A=[{type:"link",external:!0,name:"link",label:t._({id:"yzF66j"}),copy:!0,hidden:!e.link},{type:"text",name:"contact_detail.name",label:t._({id:"jfC/xh"}),icon:"user",copy:!0,hidden:!e.contact},{type:"text",name:"contact_detail.email",label:t._({id:"41BQ3k"}),icon:"email",copy:!0,hidden:!((g=e.contact_detail)!=null&&g.email)},{type:"text",name:"contact_detail.phone",label:t._({id:"P1x5uo"}),icon:"phone",copy:!0,hidden:!((L=e.contact_detail)!=null&&L.phone)},{type:"text",name:"project_code_label",label:t._({id:"Sdfr6G"}),icon:"reference",copy:!0,hidden:!e.project_code},{type:"text",name:"responsible",label:t._({id:"XQACoK"}),badge:"owner",hidden:!e.responsible}],R=[{type:"date",name:"creation_date",label:t._({id:"FNcMGM"}),copy:!0,icon:"calendar"},{type:"date",name:"issue_date",label:t._({id:"M1cChr"}),icon:"calendar",copy:!0,hidden:!e.issue_date},{type:"date",name:"start_date",label:t._({id:"D3iCkb"}),icon:"calendar",copy:!0,hidden:!e.start_date},{type:"date",name:"target_date",label:t._({id:"ZmykKo"}),icon:"calendar",copy:!0,hidden:!e.target_date},{type:"date",name:"complete_date",icon:"calendar_check",label:t._({id:"41ha49"}),copy:!0,hidden:!e.complete_date}];return s.jsxs(ve,{children:[s.jsxs(X,{grow:!0,children:[s.jsx(Re,{appRole:_.purchase_order,apiPath:c.company_list,src:(x=e.supplier_detail)==null?void 0:x.image,pk:e.supplier}),s.jsx(X.Col,{span:{base:12,sm:8},children:s.jsx(O,{fields:r,item:e})})]}),s.jsx(O,{fields:f,item:e}),s.jsx(O,{fields:A,item:e}),s.jsx(O,{fields:R,item:e})]})},[e,l,h]),W=n.useMemo(()=>[{name:"detail",label:t._({id:"Tol4BF"}),icon:s.jsx(de,{}),content:N},{name:"line-items",label:t._({id:"SgduFH"}),icon:s.jsx(ue,{}),content:s.jsxs(C,{multiple:!0,defaultValue:["line-items","extra-items"],children:[s.jsxs(C.Item,{value:"line-items",children:[s.jsx(C.Control,{children:s.jsx(Y,{size:"lg",children:t._({id:"SgduFH"})})}),s.jsx(C.Panel,{children:s.jsx(at,{order:e,orderDetailRefresh:b,currency:l,orderId:Number(a),supplierId:Number(e.supplier)})})]},"lineitems"),s.jsxs(C.Item,{value:"extra-items",children:[s.jsx(C.Control,{children:s.jsx(Y,{size:"lg",children:t._({id:"l11DG/"})})}),s.jsx(C.Panel,{children:s.jsx(He,{endpoint:c.purchase_order_extra_line_list,orderId:e.pk,orderDetailRefresh:b,currency:l,role:_.purchase_order})})]},"extraitems")]})},{name:"received-stock",label:t._({id:"b447qM"}),icon:s.jsx(pe,{}),content:s.jsx(it,{tableName:"received-stock",params:{purchase_order:a}})},Me({model_type:o.purchaseorder,model_id:e.pk}),Le({model_type:o.purchaseorder,model_id:e.pk})],[e,a,y]),m=ae({modelType:o.purchaseorder}),I=j({url:T(c.purchase_order_issue,e.pk),title:t._({id:"keApR9"}),onFormSuccess:b,preFormWarning:t._({id:"lLiNZC"}),successMessage:t._({id:"R/WvFK"})}),v=j({url:T(c.purchase_order_cancel,e.pk),title:t._({id:"98xQHK"}),onFormSuccess:b,preFormWarning:t._({id:"MPFqR0"}),successMessage:t._({id:"H5qWhm"})}),P=j({url:T(c.purchase_order_hold,e.pk),title:t._({id:"vJaCK0"}),onFormSuccess:b,preFormWarning:t._({id:"3Wfk51"}),successMessage:t._({id:"0NH/ob"})}),M=j({url:T(c.purchase_order_complete,e.pk),title:t._({id:"CWbcdO"}),successMessage:t._({id:"W7TghJ"}),timeout:1e4,fields:{accept_incomplete:{}},onFormSuccess:b,preFormWarning:t._({id:"DYITap"})}),K=n.useMemo(()=>{const r=y.hasChangeRole(_.purchase_order),f=r&&(e.status==m.PENDING||e.status==m.ON_HOLD),A=r&&(e.status==m.PENDING||e.status==m.PLACED),R=r&&e.status==m.PLACED,g=r&&e.status!=m.CANCELLED&&e.status!=m.COMPLETE;return[s.jsx(Z,{title:t._({id:"WajCDs"}),icon:"issue",hidden:!f,color:"blue",onClick:I.open}),s.jsx(Z,{title:t._({id:"NPZqBL"}),icon:"complete",hidden:!R,color:"green",onClick:M.open}),s.jsx(he,{model:o.purchaseorder,id:e.pk}),s.jsx(Ce,{model:o.purchaseorder,pk:e.pk,hash:e==null?void 0:e.barcode_hash}),s.jsx(je,{modelType:o.purchaseorder,items:[e.pk],enableReports:!0}),s.jsx(Pe,{tooltip:t._({id:"/IKytX"}),actions:[Ae({hidden:!r,tooltip:t._({id:"mVeaUg"}),onClick:()=>{S.open()}}),Se({hidden:!y.hasAddRole(_.purchase_order),onClick:()=>D.open(),tooltip:t._({id:"oi/3Pq"})}),De({tooltip:t._({id:"20mLBC"}),hidden:!A,onClick:P.open}),Ie({tooltip:t._({id:"tVJk4q"}),hidden:!g,onClick:v.open})]})]},[a,e,y,m]),U=n.useMemo(()=>h.isLoading?[]:[s.jsx(Ve,{status:e.status_custom_key,type:o.purchaseorder,options:{size:"lg"}})],[e,h]),V=n.useMemo(()=>{var f;let r=((f=e.supplier_detail)==null?void 0:f.name)||"";return e.supplier_reference&&(r+=` (${e.supplier_reference})`),r},[e]);return s.jsxs(s.Fragment,{children:[I.modal,P.modal,v.modal,M.modal,S.modal,D.modal,s.jsx(Fe,{query:h,requiredRole:_.purchase_order,children:s.jsxs(me,{gap:"xs",children:[s.jsx(Ne,{title:`${t._({id:"KxySMG"})}: ${e.reference}`,subtitle:V,imageUrl:(F=e.supplier_detail)==null?void 0:F.image,breadcrumbs:[{name:t._({id:"UOTpFa"}),url:"/purchasing/"}],lastCrumb:[{name:e.reference,url:`/purchasing/purchase-order/${e.pk}`}],actions:K,badges:U,editAction:S.open,editEnabled:y.hasChangePermission(o.purchaseorder)}),s.jsx(qe,{pageKey:"purchaseorder",panels:W,model:o.purchaseorder,instance:e,reloadInstance:b,id:e.pk})]})})]})}export{Gt as default};
//# sourceMappingURL=PurchaseOrderDetail-CUYFI1UE.js.map
