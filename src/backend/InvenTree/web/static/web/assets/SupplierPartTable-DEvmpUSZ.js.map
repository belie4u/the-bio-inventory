{"version":3,"file":"SupplierPartTable-DEvmpUSZ.js","sources":["../../../../../../frontend/src/tables/purchasing/SupplierPartTable.tsx"],"sourcesContent":["import { t } from '@lingui/core/macro';\nimport { Text } from '@mantine/core';\nimport { type ReactNode, useCallback, useMemo, useState } from 'react';\n\nimport { AddItemButton } from '@lib/components/AddItemButton';\nimport {\n  type RowAction,\n  RowDeleteAction,\n  RowEditAction\n} from '@lib/components/RowActions';\nimport { ApiEndpoints } from '@lib/enums/ApiEndpoints';\nimport { ModelType } from '@lib/enums/ModelType';\nimport { UserRoles } from '@lib/enums/Roles';\nimport { apiUrl } from '@lib/functions/Api';\nimport type { TableFilter } from '@lib/types/Filters';\nimport type { TableColumn } from '@lib/types/Tables';\nimport { useSupplierPartFields } from '../../forms/CompanyForms';\nimport {\n  useCreateApiFormModal,\n  useDeleteApiFormModal,\n  useEditApiFormModal\n} from '../../hooks/UseForm';\nimport { useTable } from '../../hooks/UseTable';\nimport { useUserState } from '../../states/UserState';\nimport {\n  BooleanColumn,\n  CompanyColumn,\n  DecimalColumn,\n  DescriptionColumn,\n  LinkColumn,\n  NoteColumn,\n  PartColumn\n} from '../ColumnRenderers';\nimport { InvenTreeTable } from '../InvenTreeTable';\nimport { TableHoverCard } from '../TableHoverCard';\n\n/*\n * Construct a table listing supplier parts\n */\n\nexport function SupplierPartTable({\n  params\n}: Readonly<{ params: any }>): ReactNode {\n  const table = useTable('supplierparts');\n\n  const user = useUserState();\n\n  // Construct table columns for this table\n  const tableColumns: TableColumn[] = useMemo(() => {\n    return [\n      PartColumn({\n        switchable: 'part' in params,\n        part: 'part_detail'\n      }),\n      {\n        accessor: 'supplier',\n        sortable: true,\n        render: (record: any) => (\n          <CompanyColumn company={record?.supplier_detail} />\n        )\n      },\n      {\n        accessor: 'SKU',\n        title: t`Supplier Part`,\n        sortable: true\n      },\n      DescriptionColumn({}),\n      {\n        accessor: 'manufacturer',\n        title: t`Manufacturer`,\n        sortable: true,\n        render: (record: any) => (\n          <CompanyColumn company={record?.manufacturer_detail} />\n        )\n      },\n      {\n        accessor: 'MPN',\n\n        sortable: true,\n        title: t`MPN`,\n        render: (record: any) => record?.manufacturer_part_detail?.MPN\n      },\n      BooleanColumn({\n        accessor: 'active',\n        title: t`Active`,\n        sortable: true,\n        switchable: true,\n        defaultVisible: false\n      }),\n      DecimalColumn({\n        accessor: 'in_stock',\n        sortable: true\n      }),\n      {\n        accessor: 'packaging',\n        sortable: true,\n        defaultVisible: false\n      },\n      {\n        accessor: 'pack_quantity',\n        sortable: true,\n\n        render: (record: any) => {\n          const part = record?.part_detail ?? {};\n\n          const extra = [];\n\n          if (part.units) {\n            extra.push(\n              <Text key='base'>\n                {t`Base units`} : {part.units}\n              </Text>\n            );\n          }\n\n          return (\n            <TableHoverCard\n              value={record.pack_quantity}\n              extra={extra}\n              title={t`Pack Quantity`}\n            />\n          );\n        }\n      },\n      LinkColumn({}),\n      NoteColumn({}),\n      {\n        accessor: 'available',\n        sortable: true,\n        defaultVisible: false,\n        render: (record: any) => {\n          const extra = [];\n\n          if (record.availablility_updated) {\n            extra.push(\n              <Text>\n                {t`Updated`} : {record.availablility_updated}\n              </Text>\n            );\n          }\n\n          return <TableHoverCard value={record.available} extra={extra} />;\n        }\n      }\n    ];\n  }, [params]);\n\n  const supplierPartFields = useSupplierPartFields({\n    partId: params?.part\n  });\n\n  const addSupplierPart = useCreateApiFormModal({\n    url: ApiEndpoints.supplier_part_list,\n    title: t`Add Supplier Part`,\n    fields: supplierPartFields,\n    initialData: {\n      part: params?.part,\n      supplier: params?.supplier\n    },\n    table: table,\n    successMessage: t`Supplier part created`\n  });\n\n  const tableActions = useMemo(() => {\n    return [\n      <AddItemButton\n        key='add-supplier-part'\n        tooltip={t`Add supplier part`}\n        onClick={() => addSupplierPart.open()}\n        hidden={!user.hasAddRole(UserRoles.purchase_order)}\n      />\n    ];\n  }, [user]);\n\n  const tableFilters: TableFilter[] = useMemo(() => {\n    return [\n      {\n        name: 'active',\n        label: t`Active`,\n        description: t`Show active supplier parts`\n      },\n      {\n        name: 'part_active',\n        label: t`Active Part`,\n        description: t`Show active internal parts`\n      },\n      {\n        name: 'supplier_active',\n        label: t`Active Supplier`,\n        description: t`Show active suppliers`\n      },\n      {\n        name: 'has_stock',\n        label: t`In Stock`,\n        description: t`Show supplier parts with stock`\n      }\n    ];\n  }, []);\n\n  const editSupplierPartFields = useSupplierPartFields({});\n\n  const [selectedSupplierPart, setSelectedSupplierPart] = useState<number>(0);\n\n  const editSupplierPart = useEditApiFormModal({\n    url: ApiEndpoints.supplier_part_list,\n    pk: selectedSupplierPart,\n    title: t`Edit Supplier Part`,\n    fields: editSupplierPartFields,\n    table: table\n  });\n\n  const deleteSupplierPart = useDeleteApiFormModal({\n    url: ApiEndpoints.supplier_part_list,\n    pk: selectedSupplierPart,\n    title: t`Delete Supplier Part`,\n    table: table\n  });\n\n  // Row action callback\n  const rowActions = useCallback(\n    (record: any): RowAction[] => {\n      return [\n        RowEditAction({\n          hidden: !user.hasChangeRole(UserRoles.purchase_order),\n          onClick: () => {\n            setSelectedSupplierPart(record.pk);\n            editSupplierPart.open();\n          }\n        }),\n        RowDeleteAction({\n          hidden: !user.hasDeleteRole(UserRoles.purchase_order),\n          onClick: () => {\n            setSelectedSupplierPart(record.pk);\n            deleteSupplierPart.open();\n          }\n        })\n      ];\n    },\n    [user, editSupplierPartFields]\n  );\n\n  return (\n    <>\n      {addSupplierPart.modal}\n      {editSupplierPart.modal}\n      {deleteSupplierPart.modal}\n      <InvenTreeTable\n        url={apiUrl(ApiEndpoints.supplier_part_list)}\n        tableState={table}\n        columns={tableColumns}\n        props={{\n          params: {\n            ...params,\n            part_detail: true,\n            supplier_detail: true,\n            manufacturer_detail: true\n          },\n          rowActions: rowActions,\n          enableDownload: true,\n          tableActions: tableActions,\n          tableFilters: tableFilters,\n          modelType: ModelType.supplierpart\n        }}\n      />\n    </>\n  );\n}\n"],"names":["SupplierPartTable","params","table","useTable","user","useUserState","tableColumns","useMemo","PartColumn","switchable","part","accessor","sortable","render","record","CompanyColumn","supplier_detail","title","_i18n","_","id","DescriptionColumn","manufacturer_detail","manufacturer_part_detail","MPN","BooleanColumn","defaultVisible","DecimalColumn","part_detail","extra","units","push","Text","TableHoverCard","pack_quantity","LinkColumn","NoteColumn","availablility_updated","jsx","available","supplierPartFields","useSupplierPartFields","partId","addSupplierPart","useCreateApiFormModal","url","ApiEndpoints","supplier_part_list","fields","initialData","supplier","successMessage","tableActions","AddItemButton","open","hasAddRole","UserRoles","purchase_order","tableFilters","name","label","description","editSupplierPartFields","selectedSupplierPart","setSelectedSupplierPart","useState","editSupplierPart","useEditApiFormModal","pk","deleteSupplierPart","useDeleteApiFormModal","rowActions","useCallback","RowEditAction","hidden","hasChangeRole","onClick","RowDeleteAction","hasDeleteRole","jsxs","Fragment","modal","InvenTreeTable","apiUrl","enableDownload","modelType","ModelType","supplierpart"],"mappings":"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"}